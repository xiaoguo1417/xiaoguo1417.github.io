<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>My Terabithia</title>
  
  
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2023-07-05T04:54:44.957Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>Xiao Peng</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>QT 关于namespace Ui</title>
    <link href="http://example.com/2023/07/05/QT%20%E5%85%B3%E4%BA%8Enamespace%20Ui/"/>
    <id>http://example.com/2023/07/05/QT%20%E5%85%B3%E4%BA%8Enamespace%20Ui/</id>
    <published>2023-07-05T04:39:33.481Z</published>
    <updated>2023-07-05T04:54:44.957Z</updated>
    
    <content type="html"><![CDATA[<h1>QT 关于namespace Ui</h1><h2 id="1-ui文件原理">1 ui文件原理</h2><p>在 Qt 中，可以使用Qt Designer 来快速设计界面，只需拖放就可以设计并快速浏览样式，并且可以生成代码，替代了用代码设计界面的工作。其主要原理是通过<mark>uic 工具</mark>将 <strong>ui 文件</strong>转换为了 <strong>ui_xxx.h代码文件</strong>。下面通过简单的例子记录 QT 关于 ui 文件的代码原理。</p><p>在 VS2019 + QT5.15 的环境下简单新建一个 widget，并在窗口中添加一个 label 和一个 pushbutton。</p><img src="https://gcore.jsdelivr.net/gh/xiaoguo1417/PicHost@main/img/ui.png" alt="ui"  /><p>首先来查看<mark>MyWidget.h</mark>文件。首先是宏<mark>Q_OBJECT</mark>，它的作用是提供<strong>信号槽机制</strong>等 QT 操作，凡是 QObject 类都需要在第一行代码写上 Q_OBJECT。然后是类的私有成员<mark>Ui::MyWidgetClass ui;</mark>，这里的 MyWidgetClass 和我们自己定义的 MyWidgetClass 类并不是同一个，它是 Ui 命名空间下的，具体是在 <strong>“ui_MyWidget.h”</strong> 文件。</p><p>在 VS 中 ui 直接是类对象，而在 Qt Creator 中一般是指针，按照我目前的理解，定义为指针是利用 <mark>PIMPL设计模式</mark>，减少了重新编译时间，即 VS 中定义为对象没有定义为指针好。</p><blockquote><p>Qt 的 <strong>moc（元对象编辑器）工具</strong>会在预处理之前，找出所有的带有Q_OBJECT宏的类，生成 moc_xxx.cpp，这个过程就是在添加 Qt 的一些机制，然后才是正常的C++编译流程。</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//MyWidget.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QtWidgets/QWidget&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ui_MyWidget.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyWidget</span> : <span class="keyword">public</span> QWidget</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MyWidget</span>(QWidget *parent = <span class="literal">nullptr</span>);</span><br><span class="line">    ~<span class="built_in">MyWidget</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::MyWidgetClass ui;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>下面就是 uic 工具根据我们绘制的 ui 文件生成的对应代码文件<mark>Ui_mywidget.h</mark>。ui 文件中上面定义了一个类 <strong>Ui_MyWidgetClass</strong>，这个类就是控制窗体上部件的行为样式，比如它的两个成员 pushButton 和 label 就表明窗体上有这两个部件，而<mark>setupUi</mark>函数里边就是写了这两个部件具体的样式、行为。当我们在自己定义的类构造函数里边使用 ui-&gt;setupUi(this) 时，是把定义的 MyWidget 类的实例对象作为参数传进去，所以 setupUi 中的部件就创建到了我们定义的窗体 MyWidget 实例上边，并设定了显示样式。这样做的好处是<strong>分离实现细节</strong>。这样的话，所有关于窗体的元素、配置、布局，便从窗体中抽离出来，任何窗体对象想使用这样的 Ui，用一个指向 Ui 类对象的指针，然后用该指针 setupUi 一下，把这个窗体对象传进去就好了。</p><p>在 ui 文件最后，定义了 <mark>Ui命名空间</mark>，这个命名空间里边有一个类 class MyWidgetClass，公有派生自Ui_MyWidgetClass，就是说 Ui::MyWidgetClass 保留继承过来的公有属性，具有 Ui_MyWidgetClass 的行为和特点。这样绕一圈是为了<strong>避免用户定义类名与 Qt 自动生成的 ui 文件中的类名冲突</strong>，因此放在了 Ui 命名空间中。Ui::MyWidgetClass 就相当于 Ui_MyWidgetClass。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/********************************************************************************</span></span><br><span class="line"><span class="comment">** Form generated from reading UI file &#x27;MyWidget.ui&#x27;</span></span><br><span class="line"><span class="comment">**</span></span><br><span class="line"><span class="comment">** Created by: Qt User Interface Compiler version 5.15.2</span></span><br><span class="line"><span class="comment">**</span></span><br><span class="line"><span class="comment">** WARNING! All changes made in this file will be lost when recompiling UI file!</span></span><br><span class="line"><span class="comment">********************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> UI_MYWIDGET_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> UI_MYWIDGET_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QtCore/QVariant&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QtWidgets/QApplication&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QtWidgets/QLabel&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QtWidgets/QPushButton&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QtWidgets/QWidget&gt;</span></span></span><br><span class="line"></span><br><span class="line">QT_BEGIN_NAMESPACE</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Ui_MyWidgetClass</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    QPushButton *pushButton;</span><br><span class="line">    QLabel *label;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setupUi</span><span class="params">(QWidget *MyWidgetClass)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (MyWidgetClass-&gt;<span class="built_in">objectName</span>().<span class="built_in">isEmpty</span>())</span><br><span class="line">            MyWidgetClass-&gt;<span class="built_in">setObjectName</span>(QString::<span class="built_in">fromUtf8</span>(<span class="string">&quot;MyWidgetClass&quot;</span>));</span><br><span class="line">        MyWidgetClass-&gt;<span class="built_in">resize</span>(<span class="number">600</span>, <span class="number">400</span>);</span><br><span class="line">        pushButton = <span class="keyword">new</span> <span class="built_in">QPushButton</span>(MyWidgetClass);</span><br><span class="line">        pushButton-&gt;<span class="built_in">setObjectName</span>(QString::<span class="built_in">fromUtf8</span>(<span class="string">&quot;pushButton&quot;</span>));</span><br><span class="line">        pushButton-&gt;<span class="built_in">setGeometry</span>(<span class="built_in">QRect</span>(<span class="number">220</span>, <span class="number">210</span>, <span class="number">131</span>, <span class="number">51</span>));</span><br><span class="line">        QFont font;</span><br><span class="line">        font.<span class="built_in">setPointSize</span>(<span class="number">10</span>);</span><br><span class="line">        pushButton-&gt;<span class="built_in">setFont</span>(font);</span><br><span class="line">        label = <span class="keyword">new</span> <span class="built_in">QLabel</span>(MyWidgetClass);</span><br><span class="line">        label-&gt;<span class="built_in">setObjectName</span>(QString::<span class="built_in">fromUtf8</span>(<span class="string">&quot;label&quot;</span>));</span><br><span class="line">        label-&gt;<span class="built_in">setGeometry</span>(<span class="built_in">QRect</span>(<span class="number">200</span>, <span class="number">120</span>, <span class="number">171</span>, <span class="number">61</span>));</span><br><span class="line">        QFont font1;</span><br><span class="line">        font1.<span class="built_in">setPointSize</span>(<span class="number">12</span>);</span><br><span class="line">        label-&gt;<span class="built_in">setFont</span>(font1);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">retranslateUi</span>(MyWidgetClass);</span><br><span class="line"></span><br><span class="line">        QMetaObject::<span class="built_in">connectSlotsByName</span>(MyWidgetClass);</span><br><span class="line">    &#125; <span class="comment">// setupUi</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">retranslateUi</span><span class="params">(QWidget *MyWidgetClass)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        MyWidgetClass-&gt;<span class="built_in">setWindowTitle</span>(QCoreApplication::<span class="built_in">translate</span>(<span class="string">&quot;MyWidgetClass&quot;</span>, <span class="string">&quot;MyWidget&quot;</span>, <span class="literal">nullptr</span>));</span><br><span class="line">        pushButton-&gt;<span class="built_in">setText</span>(QCoreApplication::<span class="built_in">translate</span>(<span class="string">&quot;MyWidgetClass&quot;</span>, <span class="string">&quot;\345\274\200\345\247\213\350\256\260\345\275\225&quot;</span>, <span class="literal">nullptr</span>));</span><br><span class="line">        label-&gt;<span class="built_in">setText</span>(QCoreApplication::<span class="built_in">translate</span>(<span class="string">&quot;MyWidgetClass&quot;</span>, <span class="string">&quot;UI\346\226\207\344\273\266\345\216\237\347\220\206\350\256\260\345\275\225&quot;</span>, <span class="literal">nullptr</span>));</span><br><span class="line">    &#125; <span class="comment">// retranslateUi</span></span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Ui &#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">MyWidgetClass</span>: <span class="keyword">public</span> Ui_MyWidgetClass &#123;&#125;;</span><br><span class="line">&#125; <span class="comment">// namespace Ui</span></span><br><span class="line"></span><br><span class="line">QT_END_NAMESPACE</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// UI_MYWIDGET_H</span></span></span><br></pre></td></tr></table></figure><p>在<mark>MyWidget.cpp</mark>文件中，主要就是语句<mark>ui.setupUi(this);</mark>，这里的 ui 对象就是指向类 Ui::MyWidgetClass。这里语句的作用和上面描述的一致，把我们定义的窗体对象传进去，setupUi 中的部件就创建到了我们定义的窗体实例上边，并设定了显示样式。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//MyWidget.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;MyWidget.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">MyWidget::<span class="built_in">MyWidget</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QWidget</span>(parent)</span><br><span class="line">&#123;</span><br><span class="line">    ui.<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MyWidget::~<span class="built_in">MyWidget</span>()</span><br><span class="line">&#123;&#125;</span><br></pre></td></tr></table></figure><h2 id="2-PIMPL设计">2 PIMPL设计</h2><p><mark>PIMPL设计模式</mark>简单来讲就是<strong>把类的成员变量设置为指针</strong>，主要作用是减少重新编译时间以及解开类的使用接口和实现的耦合。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//c.hpp</span></span><br><span class="line"> <span class="meta">#<span class="keyword">include</span><span class="string">&lt;x.hpp&gt;</span></span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">C</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">f1</span><span class="params">()</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    X x; <span class="comment">//与X的强耦合</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>像上面这样的代码，C 与它的实现就是强耦合的，从语义上说，x 成员数据是属于 C 的实现部分，不应该暴露给用户。从语言的本质上来说，在用户的代码中，每一次使用“new C”和“C c1”这样的语句，都会将<strong>X的大小硬编码到编译后的二进制代码段中</strong>（如果X有虚函数，则还不止这些）————这是因为，对“new C”这样的语句，其实相当于operator new(sizeof? )后面再跟上C的构造函数，而“C c1”则是在当前栈上腾出sizeof?大小的空间，然后调用 C 的构造函数。因此，**每次X类作了改动，使用c.hpp的源文件都必须重新编译一次，因为X的大小可能改变了。**在一个大型的项目中，这种耦合可能会对build时间产生相当大的影响。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//c.hpp</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">X</span>; <span class="comment">//用前导声明取代include</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">C</span></span><br><span class="line">&#123;</span><br><span class="line">     ...</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    X* pImpl; <span class="comment">//声明一个X*的时候，class X不用完全定义</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>在一个既定平台上，<strong>任何指针的大小都是相同的</strong>。之所以分为X*，Y*这些各种各样的指针，主要是提供一个高层的抽象语义，即该指针到底指向的是那个类的对象，并且，也给编译器一个指示，从而能够正确的对用户进行的操作（如调用X的成员函数）决议并检查。但是，如果从运行期的角度来说，每种指针都只不过是个32位的长整型（如果在64位机器上则是64位，根据当前硬件而定）。</p><p>正由于 pImpl 是个指针，所以这里 X 的二进制信息（sizeof?等）不会被耦合到 C 的使用接口上去，也就是说，当用户 “new C” 或 “C c1” 的时候，编译器生成的代码中不会掺杂 X 的任何信息，并且当用户使用 C 的时候，使用的是 C 的接口，也与 X 无关，从而 X 被这个指针彻底的与用户隔绝开来。只有 C 知道并能够操作 pImpl 成员指向的 X 对象。</p><h2 id="3-主要参考">3 主要参考</h2><p><a href="https://www.codenong.com/cs105278091/#:~:text=%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E8%A7%A3%E6%9E%90Qt%20creator%E7%9A%84ui%E6%96%87%E4%BB%B6%E5%8E%9F%E7%90%86%E5%8F%8APIMPL%E8%AE%BE%E8%AE%A1">深入浅出解析Qt creator的ui文件原理及PIMPL设计</a></p><p><a href="https://blog.csdn.net/joyride_run/article/details/130966395?spm=1001.2101.3001.6650.3&amp;utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EYuanLiJiHua%7EPosition-3-130966395-blog-93416162.235%5Ev38%5Epc_relevant_sort_base3&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EYuanLiJiHua%7EPosition-3-130966395-blog-93416162.235%5Ev38%5Epc_relevant_sort_base3&amp;utm_relevant_index=2">[QT | C++] 关于 namespace Ui 的理解</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;QT 关于namespace Ui&lt;/h1&gt;
&lt;h2 id=&quot;1-ui文件原理&quot;&gt;1 ui文件原理&lt;/h2&gt;
&lt;p&gt;在 Qt 中，可以使用Qt Designer 来快速设计界面，只需拖放就可以设计并快速浏览样式，并且可以生成代码，替代了用代码设计界面的工作。其主要原理是通</summary>
      
    
    
    
    
    <category term="Qt C++" scheme="http://example.com/tags/Qt-C/"/>
    
  </entry>
  
  <entry>
    <title>Qt多线程</title>
    <link href="http://example.com/2023/04/27/Qt%E5%A4%9A%E7%BA%BF%E7%A8%8B/"/>
    <id>http://example.com/2023/04/27/Qt%E5%A4%9A%E7%BA%BF%E7%A8%8B/</id>
    <published>2023-04-27T04:23:26.239Z</published>
    <updated>2023-04-27T12:45:09.418Z</updated>
    
    <content type="html"><![CDATA[<p>使用Qt编写程序时，为了避免耗时操作导致界面“假死”以及并行计算提高程序运行速度，我们需要使用多线程，下面记录四种多线程使用的方法。</p><h2 id="1-QThread">1 QThread</h2><p>第一种方法是使用 <mark>QThread</mark> 类，具体使用步骤如下：</p><ol><li>需要创建一个线程类的子类，让其继承 QT 中的线程类 QThread，比如:</li></ol><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyThread</span>:<span class="keyword">public</span> QThread</span><br><span class="line">&#123;</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>重写父类的 run () 方法，在该函数内部编写子线程要处理的具体的业务流程，run 对于线程的作用相当于 main 函数对于应用程序。它是线程的入口，run 的开始和结束意味着线程的开始和结束。</li></ol><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyThread</span>:<span class="keyword">public</span> QThread</span><br><span class="line">&#123;</span><br><span class="line">    ......</span><br><span class="line"> <span class="keyword">protected</span>:</span><br><span class="line">    <span class="comment">//run()函数是一个虚函数，让创建的子线程执行某个任务，需要写一个子类让其继承 QThread，并且在子类中重写父类的 run() 方法，函数体就是对应的任务处理流程</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">run</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ........</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>在主线程中创建子线程对象，new 一个就可以了</li></ol><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MyThread * subThread = <span class="keyword">new</span> MyThread;</span><br></pre></td></tr></table></figure><ol start="4"><li>启动子线程，调用 <mark>start ()</mark> 方法</li></ol><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//start()函数启动子线程，run()函数就会被调用了</span></span><br><span class="line">subThread-&gt;<span class="built_in">start</span>();</span><br></pre></td></tr></table></figure><p>当子线程别创建出来之后，父子线程之间的通信可以通过信号槽的方式，注意事项:</p><ul><li>在 Qt 中在子线程中不要操作程序中的窗口类型对象，不允许，如果操作了程序就挂了</li><li>只有主线程才能操作程序中的窗口对象，默认的线程就是主线程，自己创建的就是子线程。</li></ul><p>这种在程序中添加子线程的方式是非常简单的，但是也有弊端，假设要在一个子线程中处理多个任务，所有的处理逻辑都需要写到 run() 函数中，这样该函数中的处理逻辑就会变得非常混乱，不太容易维护。</p><h2 id="2-moveToThread">2 moveToThread</h2><p>第二种线程的创建方式弥补了第一种方式的缺点，用起来更加灵活，使用到的是<mark>moveToThread()</mark> 方法。</p><ol><li>创建一个新的类，让这个类从 <mark>QObject</mark> 派生</li></ol><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyWork</span>:<span class="keyword">public</span> QObject</span><br><span class="line">&#123;</span><br><span class="line">    .......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>在这个类中添加一个公共的成员函数，函数体就是我们要子线程中执行的业务逻辑</li></ol><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyWork</span>:<span class="keyword">public</span> QObject</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    .......</span><br><span class="line">    <span class="comment">// 函数名自己指定, 叫什么都可以, 参数可以根据实际需求添加</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">working</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>在主线程中创建一个 QThread 对象，这就是子线程的对象</li></ol><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QThread* sub = <span class="keyword">new</span> QThread;</span><br></pre></td></tr></table></figure><ol start="4"><li>在主线程中创建工作的类对象（千万不要指定给创建的对象指定父对象）</li></ol><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MyWork* work = <span class="keyword">new</span> <span class="built_in">MyWork</span>(<span class="keyword">this</span>);    <span class="comment">// error</span></span><br><span class="line">MyWork* work = <span class="keyword">new</span> MyWork;          <span class="comment">// ok</span></span><br></pre></td></tr></table></figure><ol start="5"><li>将 MyWork 对象移动到创建的子线程对象中，需要调用 QObject 类提供的 <mark>moveToThread()</mark> 方法</li></ol><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// void QObject::moveToThread(QThread *targetThread);</span></span><br><span class="line"><span class="comment">// 如果给work指定了父对象, 这个函数调用就失败了</span></span><br><span class="line"><span class="comment">// 提示： QObject::moveToThread: Cannot move objects with a parent</span></span><br><span class="line">work-&gt;<span class="built_in">moveToThread</span>(sub);<span class="comment">// 移动到子线程中工作</span></span><br></pre></td></tr></table></figure><ol start="6"><li>启动子线程，调用 <mark>start()</mark>, 这时候线程启动了，但是移动到线程中的对象并没有工作</li><li>调用 MyWork 类对象的工作函数，让这个函数开始执行，这时候是在移动到的那个子线程中运行的（<strong>包括这个对象的槽函数也会运行在子线程</strong>）</li></ol><h2 id="3-线程池-QRunnable-QThreadPool">3 线程池 QRunnable + QThreadPool</h2><p>线程池的作用是使得线程可以复用，就是执行完一个任务，并不被销毁，而是可以继续执行其他的任务，避免频繁创建线程降低效率。</p><p>Qt 中的 <mark>QThreadPool</mark> 类管理了一组 QThreads, 里边还维护了一个任务队列。QThreadPool 管理和回收各个 QThread 对象，以帮助减少使用线程的程序中的线程创建成本。每个Qt应用程序都有一个全局 QThreadPool 对象，可以通过调用 <mark>globalInstance()</mark> 来访问它。也可以单独创建一个 QThreadPool 对象使用。</p><p>在 Qt 中使用线程池需要先创建任务，添加到线程池中的每一个任务都需要是一个 <mark>QRunnable</mark> 类型，因此在程序中需要创建子类继承 QRunnable 这个类，然后重写 <mark>run()</mark> 方法，在这个函数中编写要在线程池中执行的任务，并将这个子类对象传递给线程池，这样任务就可以被线程池中的某个工作的线程处理掉了。</p><ol><li>创建一个线程子类，让其继承 <mark>QRunnable</mark>和<mark>QObject</mark>（继承 QObject 可以使用信号和槽）。</li></ol><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyWork</span> :<span class="keyword">public</span> QRunnable, <span class="keyword">public</span> QObject</span><br><span class="line">&#123;</span><br><span class="line">    .......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>重写父类的<mark>run()</mark>方法，在该函数内部编写子线程要处理的具体的业务流程</li></ol><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyWork</span> :<span class="keyword">public</span> QRunnable, <span class="keyword">public</span> QObject</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">MyWork</span><span class="params">()</span></span>;</span><br><span class="line">    ~<span class="built_in">MyWork</span>();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">run</span><span class="params">()</span> <span class="keyword">override</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MyWork::<span class="built_in">MyWork</span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 任务执行完毕,该对象自动销毁</span></span><br><span class="line">    <span class="built_in">setAutoDelete</span>(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MyWork::run</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 业务处理代码</span></span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>在主线程中初始化线程池</li></ol><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 线程池初始化，设置最大线程池数</span></span><br><span class="line">QThreadPool::<span class="built_in">globalInstance</span>()-&gt;<span class="built_in">setMaxThreadCount</span>(<span class="number">4</span>);</span><br></pre></td></tr></table></figure><ol start="4"><li>在主线程实例化子线程对象，并将其放入线程池</li></ol><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MyWork* task = <span class="keyword">new</span> MyWork;</span><br><span class="line">QThreadPool::<span class="built_in">globalInstance</span>()-&gt;<span class="built_in">start</span>(task);   </span><br></pre></td></tr></table></figure><h2 id="4-QtConcurrent">4 QtConcurrent</h2><p><mark>QtConcurrent::run</mark>能够方便快捷的将任务丢到线程池的子线程中去执行**，无需继承任何类，也不需要重写函数**，使用非常简单，但是<strong>执行完毕后没有任何信号</strong>，目前我想到的还是需要在子线程函数中添加信号，完成后触发信号表示子线程函数运行完毕。</p><ol><li>新建一个子线程类（也可以不建），将需要处理的程序放到一个公共函数中，并<strong>设置相应信号</strong></li></ol><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">myData</span> <span class="comment">//测试返回自定义数据类型</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> test = <span class="number">2</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyConcurrent</span> : <span class="keyword">public</span> QObject</span><br><span class="line">&#123;</span><br><span class="line">Q_OBJECT</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function">myData <span class="title">work</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">signals:</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">sig_finished</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">myData <span class="title">MyConcurrent::work</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Concurrent子线程对象的地址: &quot;</span> &lt;&lt; QThread::<span class="built_in">currentThread</span>();</span><br><span class="line">    ......</span><br><span class="line">    <span class="function">emit <span class="title">sig_finished</span><span class="params">()</span></span>;</span><br><span class="line">    myData m;</span><br><span class="line">    m.test = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> m;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>在主线程中实例化子线程类对象，将子线程函数完成的信号进行信号和槽连接。</li></ol><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MyConcurrent* mythread3 = <span class="keyword">new</span> MyConcurrent;</span><br><span class="line"><span class="built_in">connect</span>(mythread3, <span class="built_in">SIGNAL</span>(<span class="built_in">sig_finished</span>()), <span class="keyword">this</span>, <span class="built_in">SLOT</span>(<span class="built_in">OnSigFinished</span>()));</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol start="3"><li>将其工作函数传入<mark>QtConcurrent::run()</mark>函数中，并使用<mark>QFuture</mark>接收函数返回值。</li></ol><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在新的线程中调用普通函数 </span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="function">QFuture&lt;T&gt; <span class="title">QtConcurrent::run</span><span class="params">(Function function, ...)</span> </span></span><br><span class="line"><span class="function"><span class="comment">//使用线程池中的线程调用普通函数 </span></span></span><br><span class="line"><span class="function"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; QFuture&lt;T&gt; <span class="title">QtConcurrent::run</span><span class="params">(QThreadPool *pool, Function function, ...)</span> </span></span><br><span class="line"><span class="function"><span class="comment">//在新的线程里调用成员函数 有多个重载实现不同的参数个数 </span></span></span><br><span class="line"><span class="function"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; QFuture&lt;T&gt; <span class="title">QtConcurrent::run</span><span class="params">(className *obejct, Function function, ...)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">QFuture&lt;myData&gt; future </span>= QtConcurrent::<span class="built_in">run</span>(mythread3, &amp;MyConcurrent::work);</span><br><span class="line"><span class="comment">//future.waitForFinished();//如果使用等待则会阻塞主线程，造成界面卡死</span></span><br></pre></td></tr></table></figure><ol start="4"><li>在主线程对应的槽函数中接收子线程计算的结果。</li></ol><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">MultiThread::OnSigFinished</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (future.<span class="built_in">isFinished</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        myData&amp;&amp; m = future.<span class="built_in">result</span>();</span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-比较">5 比较</h2><table><thead><tr><th>**需要线程的生命周期                           **</th><th><strong>开发场景</strong></th><th><strong>解决方案</strong></th></tr></thead><tbody><tr><td>单次调用</td><td>在其他的线程中运行一个方法，当方法运行结束后退出线程。</td><td>（1）编写一个函数，然后利用 QtConcurrent::run()运行它；（2）从 QRunnable 派生一个类，并利用全局线程池QThreadPool::globalInstance()-&gt;start()来运行它。（3） 从QThread派生一个类, 重载QThread::run() 方法并使用QThread::start()来运行它。</td></tr><tr><td>单次调用</td><td>一个耗时的操作必须放到另一个线程中运行。在这期间，状态信息必须发送到GUI线程中。</td><td>使用 QThread,，重载run方法并根据情况发送信号。.使用queued信号/槽连接来连接信号与GUI线程的槽。</td></tr><tr><td>常驻</td><td>有一对象位于另一个线程中，将让其根据不同的请求执行不同的操作。这意味与工作者线程之间的通信是必须的。</td><td>从QObject 派生一个类并实现必要的槽和信号，将对象移到一个具有事件循环的线程中，并通过queued信号/槽连接与对象进行通信。</td></tr></tbody></table><h2 id="6-主要参考">6 主要参考</h2><p><a href="https://subingwen.cn/qt/thread/">大丙多线程</a></p><p><a href="https://blog.csdn.net/weixin_41761608/article/details/119328018">QtConcurrent::run()+QThreadPool</a></p><p><a href="http://dalang.store/2022/01/04/QT%E5%A4%9A%E7%BA%BF%E7%A8%8B/">QT多线程开发</a></p><p><a href="http://cppdebug.com/archives/319">QT多线程之QtConcurrent::run()</a></p><h2 id="7-实验代码">7 实验代码</h2><p><a href="https://github.com/xiaoguo1417/MySummaries/tree/main/MultiThread">我的github</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;使用Qt编写程序时，为了避免耗时操作导致界面“假死”以及并行计算提高程序运行速度，我们需要使用多线程，下面记录四种多线程使用的方法。&lt;/p&gt;
&lt;h2 id=&quot;1-QThread&quot;&gt;1 QThread&lt;/h2&gt;
&lt;p&gt;第一种方法是使用 &lt;mark&gt;QThread&lt;/mark&gt;</summary>
      
    
    
    
    
    <category term="Qt" scheme="http://example.com/tags/Qt/"/>
    
  </entry>
  
  <entry>
    <title>C++ Libraries</title>
    <link href="http://example.com/2022/11/23/C++%E9%9D%99%E6%80%81%E9%93%BE%E6%8E%A5%E5%BA%93%E4%B8%8E%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5%E5%BA%93/"/>
    <id>http://example.com/2022/11/23/C++%E9%9D%99%E6%80%81%E9%93%BE%E6%8E%A5%E5%BA%93%E4%B8%8E%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5%E5%BA%93/</id>
    <published>2022-11-23T04:02:25.597Z</published>
    <updated>2023-04-27T07:59:19.151Z</updated>
    
    <content type="html"><![CDATA[<p>C++中的链接库是写好的、可复用的代码，以一种可执行代码的二进制形式存在，可以被操作系统载入内存执行，Windows平台下有<mark>静态链接库（lib）</mark>和<mark>动态链接库（dll）</mark>两种。</p><p>静态链接库使用时链接器从其中获取所有被引用的函数，并将库同代码一起放到exe可执行文件中 ，其运行效率高。但对程序的更新部署和发布很不友好：假如一个模块依赖20个模块，当20个模块其中有一个模块需要更新时，需要将所有的模块都找出来重新编译出一个可执行程序才可以更新成功。</p><p>动态链接库不仅包含dll文件，也包含一个lib文件，但它的lib文件仅包含在运行时定位dll文件中函数的可执行代码所需的信息。其运行时进行链接，运行时同时存在exe文件和dll文件。相较于静态链接，动态链接在程序更新时只需要更新对应模块的dll文件，无需所有模块重新编译。</p><h2 id="1-静态链接库使用">1 静态链接库使用</h2><p>静态链接库的使用需要用到.lib文件及其对应的.h头文件，其中.h文件中包含静态库中可以使用的函数的声明，需要使用include进行包含。include包含头文件有<mark>双引号</mark>和<mark>尖括号</mark>两种形式，其形式与msvc在编译的时候搜索头文件的顺序有关，其顺序如下：</p><ul><li>用双引号（#include “xxx.h”）包含的头文件，先在本地目录下搜索</li><li>如果上一步没搜到，或者用尖括号包含的头文件（#include &lt;&gt;），通过 /I 指定的目录搜索</li><li>如果上一步骤没搜到，再搜索通过环境变量 INCLUDE 指定的目录</li></ul><p>因此，一般将放在项目文件夹中的头文件使用双引号进行包含，外部的头文件使用尖括号进行包含。</p><p>静态链接库使用时主要使项目能够获取.h文件和lib文件，其分别对应着设置中的包含目录和库目录。进行包含时包含目录和库目录不仅在VC++下有对应设置，在C++和链接器下还有对应的附加包含目录和附加库目录，其区别主要是编译器寻找的顺序不同而已，先在附加项中进行查找，然后再进行非附加项查找，因此在两个位置进行设置均可生效。另外链接库还需设置附加依赖项，其作用是说明依赖库的名字。</p><p>静态链接库的使用步骤总结如下：</p><ol><li>在<mark>包含目录或者附加包含</mark>目录中添加.h文件所在位置，并在需要使用依赖库的文件中使用include包含该头文件；</li><li>在<mark>库目录或者附加库目录</mark>中添加.lib文件所在位置；</li><li>在链接器的<mark>附加依赖项</mark>位置添加依赖库的名字。</li></ol><p><img src="https://gcore.jsdelivr.net/gh/xiaoguo1417/PicHost@main/img/%E9%93%BE%E6%8E%A5%E5%BA%93%E8%AE%BE%E7%BD%AE.png" alt=""></p><h2 id="2-动态链接库的创建和使用">2 动态链接库的创建和使用</h2><h3 id="2-1-DLL文件创建">2.1 DLL文件创建</h3><p>VS2015中可以像编写C++工程一样直接编写DLL文件。</p><h4 id="2-2-1-设置">2.2.1 设置</h4><p>使用新建项目时可以正常选择WiiN32项目或者Win32控制台应用程序：</p><p><img src="https://gcore.jsdelivr.net/gh/xiaoguo1417/PicHost@main/img/image-20220920143511322.png" alt="image-20220920143511322"></p><p>在应用程序设置界面中类型选择DLL，附加选项可以选上导出符号以及预编译头，也可以都不选。其中，<mark>导出符号</mark>（符号就是程序中定义的变量或者方法等）意为将DLL中的变量或函数等可以在调用DLL的文件中使用，C++中使用关键字<mark>__declspec(dllexport)</mark>来表示，勾选这个选项后，VS会为我们生成导出变量、函数以及类的示例，因此<strong>一般选择勾选</strong>；而预编译头即会为我们的程序添加头文件<mark>#include “stdafx.h”</mark>，其将一些常用的库放到了预编译头，直接生成了pch文件，可以加快编译速度，没有需要不勾选。</p><p><img src="https://gcore.jsdelivr.net/gh/xiaoguo1417/PicHost@main/img/image-20220920143954133.png" alt="image-20220920143954133"></p><h4 id="2-2-DLL书写">2.2 DLL书写</h4><p>勾选导出符号后，生成的导出示例程序如下，我们只需要按照其格式把我们需要导出的变量和函数等书写即可。在示例中，其将__declspec(dllexport)定义为了DLLDEMO_API，因此对于需要导出的函数等，示例均使用了DLLDEMO_API修饰。</p><p>一些DLL的函数使用了<mark>extern “C”(或EXTERN_C)</mark>进行修饰，其意义为用C规则编译指定的代码，以C语言函数名导出可以保证导出的函数名不变。由于对于不同的编译器，C++的函数重命名规则是不一样的（重载时使用），因此不使用extern &quot;C&quot;可能会导致一个编辑器编译出的文件在另一个编译器不可用。如果对于一个函数不存在重载的现象，则可以不添加extern “C”。另外，当dll的制造者跟dll的使用者采用同样的语言、同样编程环境，那么就不需要考虑函数重命名。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 下列 ifdef 块是创建使从 DLL 导出更简单的</span></span><br><span class="line"><span class="comment">// 宏的标准方法。此 DLL 中的所有文件都是用命令行上定义的 DLLDEMO_EXPORTS</span></span><br><span class="line"><span class="comment">// 符号编译的。在使用此 DLL 的</span></span><br><span class="line"><span class="comment">// 任何其他项目上不应定义此符号。这样，源文件中包含此文件的任何其他项目都会将</span></span><br><span class="line"><span class="comment">// DLLDEMO_API 函数视为是从 DLL 导入的，而此 DLL 则将用此宏定义的</span></span><br><span class="line"><span class="comment">// 符号视为是被导出的。</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> DLLDEMO_EXPORTS</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DLLDEMO_API __declspec(dllexport)</span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DLLDEMO_API __declspec(dllimport)</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 此类是从 DLLDemo.dll 导出的</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DLLDEMO_API</span> CDLLDemo &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">CDLLDemo</span>(<span class="type">void</span>);</span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span>  在此添加您的方法。</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> DLLDEMO_API <span class="type">int</span> nDLLDemo;<span class="comment">//extern声明该变量定义在其他位置</span></span><br><span class="line"></span><br><span class="line"><span class="function">DLLDEMO_API <span class="type">int</span> <span class="title">fnDLLDemo</span><span class="params">(<span class="type">void</span>)</span></span>;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DLLDemo.cpp : 定义 DLL 应用程序的导出函数。</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdafx.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;DLLDemo.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 这是导出变量的一个示例</span></span><br><span class="line">DLLDEMO_API <span class="type">int</span> nDLLDemo=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这是导出函数的一个示例。</span></span><br><span class="line"><span class="function">DLLDEMO_API <span class="type">int</span> <span class="title">fnDLLDemo</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">42</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这是已导出类的构造函数。</span></span><br><span class="line"><span class="comment">// 有关类定义的信息，请参阅 DLLDemo.h</span></span><br><span class="line">CDLLDemo::<span class="built_in">CDLLDemo</span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-2-调用DLL">2.2 调用DLL</h3><p>动态链接库的调用和静态链接库类似，只不过多了dll文件的载入，因此包含目录、库目录和附加依赖项的设置和静态链接库的步骤一致，而载入dll文件的方式主要有以下几种：</p><ol><li><mark>添加系统环境变量</mark>，VS中调试时可以通过 项目-&gt;属性-&gt;调试-&gt;环境 栏目添加.dll文件的path而成功调试，例如path=XXX/opencv/build/x64/vc14/bin/</li><li><mark>把引用的dll放到工程的可执行文件所在的目录下</mark>，即直接将.dll文件放入debug目录下或release目录</li></ol><p>另外，像OpenCV一样，生成和调用DLL文件有Debug和Release之分，对应的调用程序必须按照对应关系进行调用，即Debug程序调用Debug生成的DLL，Release程序调用Release生成的DLL。但一般来说，编译成Release的dll，Debug的程序是可以调用的。</p><p>调用DLL文件时还需要注意VS运行库的选择(MT\MD\MTd\MDd)，在使用多线程MT时候要配合静态库来使用，使用多线程MD的时候要配合动态库来使用，而多线程调试 DLL (/MDd)和多线程调试 DLL (/MTd)是Debug版本，后面没有d的是Release版本。因此，调用DLL文件时需要将运行库选择为对应的/MD或/MDd。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;C++中的链接库是写好的、可复用的代码，以一种可执行代码的二进制形式存在，可以被操作系统载入内存执行，Windows平台下有&lt;mark&gt;静态链接库（lib）&lt;/mark&gt;和&lt;mark&gt;动态链接库（dll）&lt;/mark&gt;两种。&lt;/p&gt;
&lt;p&gt;静态链接库使用时链接器从其中获取所</summary>
      
    
    
    
    
    <category term="C++" scheme="http://example.com/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>OpenCV三角测量</title>
    <link href="http://example.com/2022/09/16/OpenCV%E4%B8%89%E8%A7%92%E6%B5%8B%E9%87%8F/"/>
    <id>http://example.com/2022/09/16/OpenCV%E4%B8%89%E8%A7%92%E6%B5%8B%E9%87%8F/</id>
    <published>2022-09-16T12:07:35.202Z</published>
    <updated>2023-04-27T08:01:20.433Z</updated>
    
    <content type="html"><![CDATA[<p>使用OpenCV的三角测量可以根据立体标定得到的相机参数，以及一个特征点在左右两个相机中的像素坐标，求解得到该特征点的三维世界坐标（z坐标即深度信息）。</p><p>使用双目相机进行立体重建时，利用物体点-光心-像点三者共线的原理，在找到左右匹配的像点并且完成去畸变之后，就能够在三维空间中形成两条直线，物体点就是这两个直线的“交点”，“交点”指最小二乘交点，因为这两个直线由于偏差通常不会交于一点。</p><h2 id="1-测量原理">1.测量原理</h2><p>相机成像过程中，从世界坐标系到相机坐标系的转换式为式（1），从像素坐标系到相机坐标系的转换为式（2）</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>x</mi><mi>c</mi></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>y</mi><mi>c</mi></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>z</mi><mi>c</mi></msub></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>R</mi><mn>11</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>R</mi><mn>12</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>R</mi><mn>13</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>T</mi><mi>x</mi></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>R</mi><mn>21</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>R</mi><mn>22</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>R</mi><mn>23</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>T</mi><mi>y</mi></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>R</mi><mn>31</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>R</mi><mn>32</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>R</mi><mn>33</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>T</mi><mi>z</mi></msub></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>X</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>Y</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>Z</mi></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\begin{bmatrix}x_{c} \\y_{c} \\z_{c}\end{bmatrix}=\begin{bmatrix} R_{11} &amp;R_{12}  &amp;R_{13}  &amp;T_{x} \\ R_{21} &amp;R_{22}  &amp;R_{23}  &amp;T_{y} \\ R_{31} &amp;R_{32}  &amp;R_{33}  &amp;T_{z}    \end{bmatrix}\begin{bmatrix}X \\Y \\Z\end{bmatrix} (1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-2.25em;"><span class="pstrut" style="height:3.155em;"></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-3.397em;"><span class="pstrut" style="height:3.155em;"></span><span style="height:0.016em;width:0.6667em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.6667em' height='0.016em' style='width:0.6667em' viewBox='0 0 666.67 16' preserveAspectRatio='xMinYMin'><path d='M319 0 H403 V16 H319z M319 0 H403 V16 H319z'/></svg></span></span><span style="top:-4.05em;"><span class="pstrut" style="height:3.155em;"></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-2.25em;"><span class="pstrut" style="height:3.155em;"></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-3.397em;"><span class="pstrut" style="height:3.155em;"></span><span style="height:0.016em;width:0.6667em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.6667em' height='0.016em' style='width:0.6667em' viewBox='0 0 666.67 16' preserveAspectRatio='xMinYMin'><path d='M263 0 H347 V16 H263z M263 0 H347 V16 H263z'/></svg></span></span><span style="top:-4.05em;"><span class="pstrut" style="height:3.155em;"></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-2.25em;"><span class="pstrut" style="height:3.155em;"></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-3.397em;"><span class="pstrut" style="height:3.155em;"></span><span style="height:0.016em;width:0.6667em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.6667em' height='0.016em' style='width:0.6667em' viewBox='0 0 666.67 16' preserveAspectRatio='xMinYMin'><path d='M319 0 H403 V16 H319z M319 0 H403 V16 H319z'/></svg></span></span><span style="top:-4.05em;"><span class="pstrut" style="height:3.155em;"></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">21</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">31</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">12</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">22</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">32</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">13</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">23</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">33</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.04398em;">z</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-2.25em;"><span class="pstrut" style="height:3.155em;"></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-3.397em;"><span class="pstrut" style="height:3.155em;"></span><span style="height:0.016em;width:0.6667em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.6667em' height='0.016em' style='width:0.6667em' viewBox='0 0 666.67 16' preserveAspectRatio='xMinYMin'><path d='M263 0 H347 V16 H263z M263 0 H347 V16 H263z'/></svg></span></span><span style="top:-4.05em;"><span class="pstrut" style="height:3.155em;"></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-2.25em;"><span class="pstrut" style="height:3.155em;"></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-3.397em;"><span class="pstrut" style="height:3.155em;"></span><span style="height:0.016em;width:0.6667em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.6667em' height='0.016em' style='width:0.6667em' viewBox='0 0 666.67 16' preserveAspectRatio='xMinYMin'><path d='M319 0 H403 V16 H319z M319 0 H403 V16 H319z'/></svg></span></span><span style="top:-4.05em;"><span class="pstrut" style="height:3.155em;"></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-2.25em;"><span class="pstrut" style="height:3.155em;"></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-3.397em;"><span class="pstrut" style="height:3.155em;"></span><span style="height:0.016em;width:0.6667em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.6667em' height='0.016em' style='width:0.6667em' viewBox='0 0 666.67 16' preserveAspectRatio='xMinYMin'><path d='M263 0 H347 V16 H263z M263 0 H347 V16 H263z'/></svg></span></span><span style="top:-4.05em;"><span class="pstrut" style="height:3.155em;"></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>z</mi><mi>c</mi></msub><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>u</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>v</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>f</mi><mi>x</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>c</mi><mi>x</mi></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>f</mi><mi>y</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>c</mi><mi>y</mi></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>x</mi><mi>c</mi></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>y</mi><mi>c</mi></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>z</mi><mi>c</mi></msub></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo stretchy="false">(</mo><mn>2</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">z_{c}\begin{bmatrix}u \\v \\1\end{bmatrix}=\begin{bmatrix} f_{x} &amp; 0  &amp;c_{x} \\ 0 &amp;f_{y}  &amp;c_{y} \\ 0 &amp;0  &amp;1 \end{bmatrix} \begin{bmatrix}x_{c} \\y_{c} \\z_{c}\end{bmatrix} (2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-2.25em;"><span class="pstrut" style="height:3.155em;"></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-3.397em;"><span class="pstrut" style="height:3.155em;"></span><span style="height:0.016em;width:0.6667em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.6667em' height='0.016em' style='width:0.6667em' viewBox='0 0 666.67 16' preserveAspectRatio='xMinYMin'><path d='M319 0 H403 V16 H319z M319 0 H403 V16 H319z'/></svg></span></span><span style="top:-4.05em;"><span class="pstrut" style="height:3.155em;"></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">u</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-2.25em;"><span class="pstrut" style="height:3.155em;"></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-3.397em;"><span class="pstrut" style="height:3.155em;"></span><span style="height:0.016em;width:0.6667em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.6667em' height='0.016em' style='width:0.6667em' viewBox='0 0 666.67 16' preserveAspectRatio='xMinYMin'><path d='M263 0 H347 V16 H263z M263 0 H347 V16 H263z'/></svg></span></span><span style="top:-4.05em;"><span class="pstrut" style="height:3.155em;"></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-2.25em;"><span class="pstrut" style="height:3.155em;"></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-3.397em;"><span class="pstrut" style="height:3.155em;"></span><span style="height:0.016em;width:0.6667em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.6667em' height='0.016em' style='width:0.6667em' viewBox='0 0 666.67 16' preserveAspectRatio='xMinYMin'><path d='M319 0 H403 V16 H319z M319 0 H403 V16 H319z'/></svg></span></span><span style="top:-4.05em;"><span class="pstrut" style="height:3.155em;"></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-2.25em;"><span class="pstrut" style="height:3.155em;"></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-3.397em;"><span class="pstrut" style="height:3.155em;"></span><span style="height:0.016em;width:0.6667em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.6667em' height='0.016em' style='width:0.6667em' viewBox='0 0 666.67 16' preserveAspectRatio='xMinYMin'><path d='M263 0 H347 V16 H263z M263 0 H347 V16 H263z'/></svg></span></span><span style="top:-4.05em;"><span class="pstrut" style="height:3.155em;"></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-2.25em;"><span class="pstrut" style="height:3.155em;"></span><span class="delimsizinginner delim-size4"><span>⎣</span></span></span><span style="top:-3.397em;"><span class="pstrut" style="height:3.155em;"></span><span style="height:0.016em;width:0.6667em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.6667em' height='0.016em' style='width:0.6667em' viewBox='0 0 666.67 16' preserveAspectRatio='xMinYMin'><path d='M319 0 H403 V16 H319z M319 0 H403 V16 H319z'/></svg></span></span><span style="top:-4.05em;"><span class="pstrut" style="height:3.155em;"></span><span class="delimsizinginner delim-size4"><span>⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-2.25em;"><span class="pstrut" style="height:3.155em;"></span><span class="delimsizinginner delim-size4"><span>⎦</span></span></span><span style="top:-3.397em;"><span class="pstrut" style="height:3.155em;"></span><span style="height:0.016em;width:0.6667em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.6667em' height='0.016em' style='width:0.6667em' viewBox='0 0 666.67 16' preserveAspectRatio='xMinYMin'><path d='M263 0 H347 V16 H263z M263 0 H347 V16 H263z'/></svg></span></span><span style="top:-4.05em;"><span class="pstrut" style="height:3.155em;"></span><span class="delimsizinginner delim-size4"><span>⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">(</span><span class="mord">2</span><span class="mclose">)</span></span></span></span></span></p><p>根据式（1）可以得到：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mrow><mo fence="true">{</mo><mtable rowspacing="0.36em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msubsup><mi>x</mi><mi>c</mi><msup><mrow></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></msubsup><mo>=</mo><msub><mi>x</mi><mi>c</mi></msub><mi mathvariant="normal">/</mi><msub><mi>z</mi><mi>c</mi></msub><mo>=</mo><mfrac><mrow><msub><mi>R</mi><mn>11</mn></msub><msub><mi>x</mi><mi>w</mi></msub><mo>+</mo><msub><mi>R</mi><mn>12</mn></msub><msub><mi>y</mi><mi>w</mi></msub><mo>+</mo><msub><mi>R</mi><mn>13</mn></msub><msub><mi>z</mi><mi>w</mi></msub><mo>+</mo><msub><mi>T</mi><mi>x</mi></msub></mrow><mrow><msub><mi>R</mi><mn>31</mn></msub><msub><mi>x</mi><mi>w</mi></msub><mo>+</mo><msub><mi>R</mi><mn>32</mn></msub><msub><mi>y</mi><mi>w</mi></msub><mo>+</mo><msub><mi>R</mi><mn>33</mn></msub><msub><mi>z</mi><mi>w</mi></msub><mo>+</mo><msub><mi>T</mi><mi>z</mi></msub></mrow></mfrac></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msubsup><mi>y</mi><mi>c</mi><msup><mrow></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></msubsup><mo>=</mo><msub><mi>y</mi><mi>c</mi></msub><mi mathvariant="normal">/</mi><msub><mi>z</mi><mi>c</mi></msub><mo>=</mo><mfrac><mrow><msub><mi>R</mi><mn>21</mn></msub><msub><mi>x</mi><mi>w</mi></msub><mo>+</mo><msub><mi>R</mi><mn>22</mn></msub><msub><mi>y</mi><mi>w</mi></msub><mo>+</mo><msub><mi>R</mi><mn>23</mn></msub><msub><mi>z</mi><mi>w</mi></msub><mo>+</mo><msub><mi>T</mi><mi>y</mi></msub></mrow><mrow><msub><mi>R</mi><mn>31</mn></msub><msub><mi>x</mi><mi>w</mi></msub><mo>+</mo><msub><mi>R</mi><mn>32</mn></msub><msub><mi>y</mi><mi>w</mi></msub><mo>+</mo><msub><mi>R</mi><mn>33</mn></msub><msub><mi>z</mi><mi>w</mi></msub><mo>+</mo><msub><mi>T</mi><mi>z</mi></msub></mrow></mfrac></mrow></mstyle></mtd></mtr></mtable></mrow><mo stretchy="false">(</mo><mn>3</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\begin{cases}x_{c}^{&#x27;} = x_{c} / z_{c}=\frac{R_{11}x_{w}+R_{12}y_{w}+R_{13}z_{w}+T_{x}}{R_{31}x_{w}+R_{32}y_{w}+R_{33}z_{w}+T_{z}}  \\y_{c}^{&#x27;} = y_{c} / z_{c}=\frac{R_{21}x_{w}+R_{22}y_{w}+R_{23}z_{w}+T_{y}}{R_{31}x_{w}+R_{32}y_{w}+R_{33}z_{w}+T_{z}} \end{cases} (3)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3em;vertical-align:-1.25em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.7391em;"><span style="top:-3.7391em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9425em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8278em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9244em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:-0.0077em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">31</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1645em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:-0.0077em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">32</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1645em;"><span style="top:-2.357em;margin-left:-0.0359em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:-0.0077em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">33</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1645em;"><span style="top:-2.357em;margin-left:-0.044em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1645em;"><span style="top:-2.357em;margin-left:-0.1389em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.04398em;">z</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4461em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:-0.0077em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1645em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:-0.0077em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">12</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1645em;"><span style="top:-2.357em;margin-left:-0.0359em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:-0.0077em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">13</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1645em;"><span style="top:-2.357em;margin-left:-0.044em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1645em;"><span style="top:-2.357em;margin-left:-0.1389em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4811em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9425em;"><span style="top:-2.453em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8278em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9857em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:-0.0077em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">31</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1645em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:-0.0077em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">32</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1645em;"><span style="top:-2.357em;margin-left:-0.0359em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:-0.0077em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">33</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1645em;"><span style="top:-2.357em;margin-left:-0.044em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1645em;"><span style="top:-2.357em;margin-left:-0.1389em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.04398em;">z</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.5073em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:-0.0077em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">21</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1645em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:-0.0077em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">22</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1645em;"><span style="top:-2.357em;margin-left:-0.0359em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:-0.0077em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">23</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1645em;"><span style="top:-2.357em;margin-left:-0.044em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1645em;"><span style="top:-2.357em;margin-left:-0.1389em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2819em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4811em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2391em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mopen">(</span><span class="mord">3</span><span class="mclose">)</span></span></span></span></span></p><p>根据式（3）可以发现，当已知左右两个相机对于同一个物体点的坐标<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>x</mi><mrow><mi>c</mi><mn>1</mn></mrow><msup><mrow></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></msubsup><mo separator="true">,</mo><msubsup><mi>y</mi><mrow><mi>c</mi><mn>1</mn></mrow><msup><mrow></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></msubsup></mrow><annotation encoding="application/x-tex">x_{c1}^{&#x27;},y_{c1}^{&#x27;}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1906em;vertical-align:-0.2481em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9425em;"><span style="top:-2.4519em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8278em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9425em;"><span style="top:-2.4519em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8278em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span></span></span></span>和<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>x</mi><mrow><mi>c</mi><mn>2</mn></mrow><msup><mrow></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></msubsup><mo separator="true">,</mo><msubsup><mi>y</mi><mrow><mi>c</mi><mn>2</mn></mrow><msup><mrow></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></msubsup></mrow><annotation encoding="application/x-tex">x_{c2}^{&#x27;},y_{c2}^{&#x27;}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1906em;vertical-align:-0.2481em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9425em;"><span style="top:-2.4519em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mord mtight">2</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8278em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9425em;"><span style="top:-2.4519em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mord mtight">2</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8278em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2481em;"><span></span></span></span></span></span></span></span></span></span>以及旋转矩阵和平移矩阵时（一般将第一个相机的相机坐标系当作世界坐标系，故第一个相机的旋转矩阵为单位矩阵，平移矩阵为0，第二个相机的旋转矩阵和平移矩阵即为两个相机之间的旋转和平移矩阵），这是有四个方程三个未知量，这是一个超定问题，OpenCV将其转换为“Ax=0&quot;的矩阵形式，利用SVD分解解算未知数。</p><h2 id="2-函数使用">2.函数使用</h2><p>OpenCV中三角测量对应函数为<mark>triangulatePoints()</mark>,函数原型及对应参数含义为：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">cv::triangulatePoints</span><span class="params">(InputArray projMatr1,</span></span></span><br><span class="line"><span class="params"><span class="function">InputArray projMatr2,</span></span></span><br><span class="line"><span class="params"><span class="function">InputArray projPoints1,</span></span></span><br><span class="line"><span class="params"><span class="function">InputArray projPoints2,</span></span></span><br><span class="line"><span class="params"><span class="function">OutputArray points4D </span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span></span><br></pre></td></tr></table></figure><table><thead><tr><th>参数</th><th>含义</th></tr></thead><tbody><tr><td>projMatr1</td><td>第一个相机的投影矩阵，大小为3*4，一般以第一个相机为基准（即以第一个相机的相机坐标系作为世界坐标系），故其为旋转对应为单位矩阵，平移对应0</td></tr><tr><td>projMatr2</td><td>第二个相机的投影矩阵，大小为3*4，参数为两个相机之间的旋转平移矩阵，一般通过立体标定函数<mark>stereoCalibrate()</mark>得到；由理论推导过程可知，R、T为从右相机坐标系到左相机坐标系的转换</td></tr><tr><td>projPoints1</td><td>第一个相机下的二维点集，需要将像素坐标归一化在相机坐标系下（从像素坐标系转换到相机坐标系）</td></tr><tr><td>projPoints2</td><td>第二个相机下的二维点集，需要将像素坐标归一化在相机坐标系下</td></tr><tr><td>points4D</td><td>输出的点集对应的齐次坐标，形式为4*N，需要将前三个维度除以第四个维度得到非齐次坐标的坐标</td></tr></tbody></table><p>对于两个投影矩阵，其一般设为如下（R,T为立体标定得到参数）：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Mat T1 = (<span class="built_in">Mat_</span>&lt;<span class="type">float</span>&gt;(<span class="number">3</span>, <span class="number">4</span>) &lt;&lt;</span><br><span class="line"><span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line"><span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line"><span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">Mat T2 = (<span class="built_in">Mat_</span>&lt;<span class="type">float</span>&gt;(<span class="number">3</span>, <span class="number">4</span>) &lt;&lt;</span><br><span class="line">R.<span class="built_in">at</span>&lt;<span class="type">double</span>&gt;(<span class="number">0</span>, <span class="number">0</span>), R.<span class="built_in">at</span>&lt;<span class="type">double</span>&gt;(<span class="number">0</span>, <span class="number">1</span>), R.<span class="built_in">at</span>&lt;<span class="type">double</span>&gt;(<span class="number">0</span>, <span class="number">2</span>), T.<span class="built_in">at</span>&lt;<span class="type">double</span>&gt;(<span class="number">0</span>, <span class="number">0</span>),</span><br><span class="line">R.<span class="built_in">at</span>&lt;<span class="type">double</span>&gt;(<span class="number">1</span>, <span class="number">0</span>), R.<span class="built_in">at</span>&lt;<span class="type">double</span>&gt;(<span class="number">1</span>, <span class="number">1</span>), R.<span class="built_in">at</span>&lt;<span class="type">double</span>&gt;(<span class="number">1</span>, <span class="number">2</span>), T.<span class="built_in">at</span>&lt;<span class="type">double</span>&gt;(<span class="number">1</span>, <span class="number">0</span>),</span><br><span class="line">R.<span class="built_in">at</span>&lt;<span class="type">double</span>&gt;(<span class="number">2</span>, <span class="number">0</span>), R.<span class="built_in">at</span>&lt;<span class="type">double</span>&gt;(<span class="number">2</span>, <span class="number">1</span>), R.<span class="built_in">at</span>&lt;<span class="type">double</span>&gt;(<span class="number">2</span>, <span class="number">2</span>), T.<span class="built_in">at</span>&lt;<span class="type">double</span>&gt;(<span class="number">2</span>, <span class="number">0</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>OpenCV的坐标经过了相机归一化平面的处理，也就是令<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>x</mi><mi>c</mi><msup><mrow></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></msubsup><mo>=</mo><msub><mi>x</mi><mi>c</mi></msub><mi mathvariant="normal">/</mi><msub><mi>z</mi><mi>c</mi></msub></mrow><annotation encoding="application/x-tex">x_{c}^{&#x27;} = x_{c} / z_{c}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1895em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9425em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8278em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>y</mi><mi>c</mi><msup><mrow></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></msubsup><mo>=</mo><msub><mi>y</mi><mi>c</mi></msub><mi mathvariant="normal">/</mi><msub><mi>z</mi><mi>c</mi></msub></mrow><annotation encoding="application/x-tex">y_{c}^{&#x27;} = y_{c} / z_{c}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1895em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9425em;"><span style="top:-2.453em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8278em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.044em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>的处理，这里的<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>x</mi><mi>c</mi><msup><mrow></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></msubsup><mtext>，</mtext><msubsup><mi>y</mi><mi>c</mi><msup><mrow></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></msubsup></mrow><annotation encoding="application/x-tex">x_{c}^{&#x27;}，y_{c}^{&#x27;}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1895em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9425em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8278em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mord cjk_fallback">，</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9425em;"><span style="top:-2.453em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8278em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span></span>就是函数中需要的归一化坐标。已知左右相机上匹配的同名点<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>u</mi><mn>1</mn></msub><mtext>，</mtext><msub><mi>v</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(u_{1}，v_{1})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord cjk_fallback">，</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>和<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>u</mi><mn>2</mn></msub><mtext>，</mtext><msub><mi>v</mi><mn>2</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(u_{2}，v_{2})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord cjk_fallback">，</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>，根据式 (2) 能便够得到分别对应的归一化坐标，转换式为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>x</mi><mi>c</mi><msup><mrow></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></msubsup><mo>=</mo><mo stretchy="false">(</mo><mi>u</mi><mo>−</mo><msub><mi>u</mi><mn>0</mn></msub><mo stretchy="false">)</mo><mi mathvariant="normal">/</mi><msub><mi>f</mi><mi>x</mi></msub></mrow><annotation encoding="application/x-tex">x_{c}^{&#x27;}=(u-u_{0})/f_{x}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1895em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9425em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8278em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">u</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord">/</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>和<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>y</mi><mi>c</mi><msup><mrow></mrow><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></msubsup><mo>=</mo><mo stretchy="false">(</mo><mi>v</mi><mo>−</mo><msub><mi>v</mi><mn>0</mn></msub><mo stretchy="false">)</mo><mi mathvariant="normal">/</mi><msub><mi>f</mi><mi>y</mi></msub></mrow><annotation encoding="application/x-tex">y_{c}^{&#x27;}=(v-v_{0})/f_{y}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1895em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9425em;"><span style="top:-2.453em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8278em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord">/</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>，封装成函数如下，输入的点p为像素坐标，矩阵K为相机内参矩阵：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Point2f <span class="title">pixel2cam</span><span class="params">(<span class="type">const</span> Point2f&amp; p, <span class="type">const</span> Mat&amp; K)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">Point2f</span></span><br><span class="line">(</span><br><span class="line">(p.x - K.<span class="built_in">at</span>&lt;<span class="type">double</span>&gt;(<span class="number">0</span>, <span class="number">2</span>)) / K.<span class="built_in">at</span>&lt;<span class="type">double</span>&gt;(<span class="number">0</span>, <span class="number">0</span>),</span><br><span class="line">(p.y - K.<span class="built_in">at</span>&lt;<span class="type">double</span>&gt;(<span class="number">1</span>, <span class="number">2</span>)) / K.<span class="built_in">at</span>&lt;<span class="type">double</span>&gt;(<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接下来就可以将构造好的参数输入函数中，在得到输出结果后再将四维齐次坐标转换为非齐次的世界坐标。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Mat pts_4d;</span><br><span class="line"><span class="built_in">triangulatePoints</span>(T1, T2, pts1, pts2, pts_4d);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 转换成非齐次坐标</span></span><br><span class="line">vector&lt;Point3f&gt; pts_result;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; pts_4d.cols; i++)</span><br><span class="line">&#123;</span><br><span class="line">Mat x = pts_4d.<span class="built_in">col</span>(i);</span><br><span class="line">x /= x.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(<span class="number">3</span>, <span class="number">0</span>); <span class="comment">// 归一化</span></span><br><span class="line"><span class="function">Point3f <span class="title">p</span><span class="params">(x.at&lt;<span class="type">float</span>&gt;(<span class="number">0</span>, <span class="number">0</span>), x.at&lt;<span class="type">float</span>&gt;(<span class="number">1</span>, <span class="number">0</span>), x.at&lt;<span class="type">float</span>&gt;(<span class="number">2</span>, <span class="number">0</span>))</span></span>;</span><br><span class="line">pts_result.<span class="built_in">push_back</span>(p);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>主要参考博客链接：</p><p><a href="https://blog.csdn.net/Xuuxq/article/details/123439617">triangulatePoints()函数使用方法</a></p><p><a href="https://blog.csdn.net/weixin_43956164/article/details/124266267?spm=1001.2101.3001.6661.1&amp;utm_medium=distribute.pc_relevant_t0.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-1-124266267-blog-100673600.t5_refersearch_landing&amp;depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-1-124266267-blog-100673600.t5_refersearch_landing&amp;utm_relevant_index=1">原理解析</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;使用OpenCV的三角测量可以根据立体标定得到的相机参数，以及一个特征点在左右两个相机中的像素坐标，求解得到该特征点的三维世界坐标（z坐标即深度信息）。&lt;/p&gt;
&lt;p&gt;使用双目相机进行立体重建时，利用物体点-光心-像点三者共线的原理，在找到左右匹配的像点并且完成去畸变之后，</summary>
      
    
    
    
    
    <category term="OpenCV" scheme="http://example.com/tags/OpenCV/"/>
    
  </entry>
  
  <entry>
    <title>HUD简介</title>
    <link href="http://example.com/2022/08/28/HUD/"/>
    <id>http://example.com/2022/08/28/HUD/</id>
    <published>2022-08-28T13:09:14.502Z</published>
    <updated>2023-04-27T08:00:36.250Z</updated>
    
    <content type="html"><![CDATA[<p>抬头显示系统（Head-Up Display,HUD)，亦称平视显示系统，是一种光学虚像显示系统。此系统通过光学镜片的反射或折射，将与汽车、飞机行驶相关的各种信息通过位于驾驶者视线正前方的放大虚像来呈现。虚像与景物同时出现在驾驶者的视野中，这样可以让驾驶者的视线一直保持在路面之上，而不用低头去看仪表盘、中控台。</p><h2 id="1-机载HUD">1. 机载HUD</h2><p>和许多高新科技一样，HUD也是从军事领域过渡到民用的技术，HUD的前身是使用在战斗机上的光学瞄准器，这种瞄准器是一种光学虚拟图像，其利原理是先将光学瞄准刻度的图像反射到飞行员座舱前方的透明玻璃板上，然后透明玻璃板把图像光线反射到飞行员眼睛中，通过特定的光学设计飞行员看到的光学瞄准器是一个位于无穷远的虚像。由于飞行员是透过透明的玻璃板观察瞄准器虚像，所以飞行员可以同时看到瞄准器刻度和目标位置，提高了对目标的打击准确度。</p><h3 id="1-1-折射式HUD">1.1 折射式HUD</h3><p>折射式平显，原理是计算机接收接口单元送来的数据，处理后产生信号，控制CRT内的电子束产生图像，再通过一组平行透镜和一片半透明镜在显示单元上投射出图像。外界光线可以部分透过显示单元，同时来自CRT的光线也会被部分反射进入飞行员的眼中。</p><p>目前车载HUD基本为这一形式的变形，衍射式由于其复杂的工艺和高昂的价格还未在汽车上大量应用。</p><p><img src="https://gcore.jsdelivr.net/gh/xiaoguo1417/PicHost@main/img/%E6%8A%98%E5%B0%84%E5%BC%8F.png" alt="折射式"></p><h3 id="1-2-衍射式HUD">1.2 衍射式HUD</h3><p>所谓衍射式就是平显的组合玻璃不再是平板肚摸玻璃，而是带小刻蚀线的（双）曲面玻璃制成的全息透镜，光线不是反射，而是衍射到飞行员的眼睛里（所以衍射式平显也叫全息平显）。</p><p>衍射平显主要应用了光学全息照相的方法，主要包括波前记录和波前在现两个过程。简单来说，应用于平视显示器时，波前记录就是指全息元件的制作过程，波前再现指衍射平视显示器的显示过程。但整个光学系统的像差会严重不对称。为此，需要有一个复杂的非对称中继透镜组来平衡校正系统的不对称像差，中继透镜组的每个透镜都将可能是倾斜偏心的，且透镜数量会比较多。设计的主要难点是因为引入全息透镜导致像差难以纠正以及全息材料、全息记录等带来的各种不确定性。</p><p><img src="https://gcore.jsdelivr.net/gh/xiaoguo1417/PicHost@main/img/%E8%A1%8D%E5%B0%84%E5%B9%B3%E6%98%BE.jpeg" alt="衍射平显"></p><h2 id="2-车载HUD">2. 车载HUD</h2><p>车载视觉辅助系统，即汽车平视显示系统，把行车信息投射成一个虚像，显示在驾驶员前方的一定距离处，为驾驶员在汽车行驶过程中提供汽车的关键数据，比如车速、转速、油量、轮胎压力等仪表信息，甚至还可以显示实时导航信息，虚像的显示亮度、水平显示位置和垂直显示位置可以根据需求调节。汽车 HUD 能够使驾驶员在平视状态下获取驾驶信息，避免了因低头产生的盲区时间，从而减少潜在的道路交通事故,因此,汽车HUD对提高驾车舒适度、保障行车安全有着重要的意义。</p><p>随着汽车市场的发展,汽车HUD也根据市场需求发展出了几种不同的类型，目前主要可分为直接反射式HUD (Entry HUD，E-HUD) 、组合型 HUD(Combiner HUD，C-HUD）、挡风玻璃HUD ( Windshield HUD，W-HUD)和以及与虚拟现实结合的HUD (Augmented Reality HUD，AR-HUD)。其中W-HUD和E-HUD是利用汽车前挡风玻璃把虚像光线反射到驾驶员眼睛中，C-HUD是利用一块透明玻璃板反射虚像到驾驶员眼睛中,透明玻璃板正对驾驶员放置于汽车前挡风玻璃与仪表台之间。其中把虚像反射到驾驶员眼睛中的汽车前挡风玻璃或者透明玻璃板叫做汽车 HUD的组合器，其作用是使驾驶员能够同时看到虚像与车外环境。</p><h3 id="2-1-E-HUD">2.1 E-HUD</h3><p><mark>E-HUD</mark>是简化的HUD版本，一般是将一块段码式显示屏安装于汽车前挡风玻璃与仪表盘之间的仪表台上，显示屏面向汽车前挡风玻璃显示镜像图像，经过汽车前挡风玻璃反射到人眼中，人眼看到的是正向的虚像。E-HUD显示的虚像只经过汽车前挡风玻璃的一次简单反射，没有精密的光路设计，因此这种方式显示的虚像较为模糊，而且视距很短，通常不超过0.3m。总体来说，E-HUD虚像视距短、成像不清晰、功能简单，长时间使用会加重驾驶员的眼部疲劳，造成额外的视觉负担。</p><p><img src="https://gcore.jsdelivr.net/gh/xiaoguo1417/PicHost@main/img/ehud.png" alt="ehud"></p><h3 id="2-2-C-HUD">2.2 C-HUD</h3><p><mark>C-HUD</mark>使用一块经过光学设计的透明玻璃板作为组合器。C-HUD没有与汽车集成在一起,它的整套光学成像系统是独立的。光路中的组合器正对驾驶员眼睛，驾驶员透过这块透明玻璃板可以看到虚像内容。这种设计方法降低了光学设计难度，提高了显示效果,但由于仪表上方狭小的空间限制了透明玻璃板面积，所以C-HUD的显示的虚像面积较小、视距较短。C-HUD的机身一般是安装于汽车前挡风玻璃与仪表台之间,机身和组合器会对驾驶员的视野造成一定的阻碍,影响驾驶体验。目前类似车萝卜等的C-HUD工艺已经成熟，但成像大多在2m以内。</p><p><img src="https://gcore.jsdelivr.net/gh/xiaoguo1417/PicHost@main/img/chud.png" alt="chud"></p><p>其光学原理与凹面镜在焦距内成像原理相似，如下图。AB为实像，FO为焦距，RO为球面曲率中心，A’B’为所成虚像。由相似三角形，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi>R</mi><mi>B</mi></mrow><mrow><mi>R</mi><msup><mi>B</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow></mfrac><mo>=</mo><mfrac><mrow><mi>A</mi><mi>B</mi></mrow><mrow><msup><mi>A</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><msup><mi>B</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow></mfrac><mo separator="true">;</mo><mfrac><mrow><mi>F</mi><mi>O</mi></mrow><mrow><mi>F</mi><msup><mi>B</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow></mfrac><mo>=</mo><mfrac><mrow><mi>C</mi><mi>O</mi></mrow><mrow><msup><mi>A</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><msup><mi>B</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{RB}{RB&#x27;} = \frac{AB}{A&#x27;B&#x27;};\frac{FO}{FB&#x27;} = \frac{CO}{A&#x27;B&#x27;}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2173em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8723em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">RB</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.2173em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8723em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">A</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">A</span><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8723em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">F</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">FO</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.2173em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8723em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">A</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6828em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">CO</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>;令物距u=BO，像距v=B’O，焦距f=FO，凹面镜交点大约在1/2半径处，所以2FO=RO，可以推导出<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mn>2</mn><mi>f</mi><mo>−</mo><mi>u</mi></mrow><mrow><mn>2</mn><mi>f</mi><mo>+</mo><mi>v</mi></mrow></mfrac><mo>=</mo><mfrac><mi>f</mi><mrow><mi>f</mi><mo>+</mo><mi>v</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{2f-u}{2f+v} = \frac{f}{f+v}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.4133em;vertical-align:-0.4811em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9322em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4461em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight">u</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4811em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.4133em;vertical-align:-0.4811em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9322em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4461em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4811em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>。</p><p>可得像距<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi><mo>=</mo><mfrac><mrow><mi>u</mi><mi>f</mi></mrow><mrow><mi>f</mi><mo>−</mo><mi>u</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">v= \frac{uf}{f-u}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.4133em;vertical-align:-0.4811em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9322em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight">u</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4461em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4811em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>，放大倍数<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo>=</mo><mfrac><mrow><msup><mi>A</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><msup><mi>B</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup></mrow><mrow><mi>A</mi><mi>B</mi></mrow></mfrac><mo>=</mo><mfrac><mrow><mn>2</mn><mi>f</mi><mo>+</mo><mi>v</mi></mrow><mrow><mn>2</mn><mi>f</mi><mo>−</mo><mi>u</mi></mrow></mfrac><mo>=</mo><mfrac><mi>f</mi><mrow><mi>f</mi><mo>−</mo><mi>u</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">d=\frac{A&#x27;B&#x27;}{AB}=\frac{2f+v}{2f-u} = \frac{f}{f-u}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.3185em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9735em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">A</span><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">A</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8278em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8278em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.4133em;vertical-align:-0.4811em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9322em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight">u</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4461em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4811em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.4133em;vertical-align:-0.4811em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9322em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight">u</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4461em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4811em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></p><p><img src="https://gcore.jsdelivr.net/gh/xiaoguo1417/PicHost@main/img/%E5%87%B9%E9%9D%A2%E9%95%9C%E6%88%90%E5%83%8F.png" alt="凹面镜成像"></p><h3 id="2-3-W-HUD">2.3 W-HUD</h3><p><mark>W-HUD</mark>利用汽车前挡风玻璃作为组合器将虚像光线反射到驾驶员眼睛中，驾驶员直接透过汽车前挡风玻璃观察虚像信息。汽车前挡风玻璃一般是不规则面型，参与反射成像时会引入像差，不同车型的前挡风玻璃面型也有差别，所以 W-HUD 需要根据不同车型的前挡风玻璃面型设计特定的光路。W-HUD是集成在汽车仪表台内部的，但汽车仪表台内的空间有限，为了能够在汽车仪表台里面安装HUD系统，其光路结构要足够精简，同时还要矫正光路中产生的像差，目前W-HUD光路中的反射镜多采用自由曲面。W-HUD光路设计难度较大，但与车身集成度高，显示效果好。W-HUD显示的虚像视距和面积等性能参数都有很大的设计空间，是目前汽车HUD的主要发展方向。</p><p><img src="https://gcore.jsdelivr.net/gh/xiaoguo1417/PicHost@main/img/image-20220828205826614.png" alt="image-20220828205826614"></p><h3 id="2-4-AR-HUD">2.4 AR-HUD</h3><p>增强现实技术（Augmented Reality, AR）是利用计算机技术将虚拟环境信息与真实世界相结合的新技术，其利用实时的“虚实”融合技术，对真实环境起着补充和强调的作用。</p><p><mark>AR-HUD</mark> 同样也是将汽车挡风玻璃作为投影介质进行图像显示，与W-HUD一样也存在重影的问题，但AR-HUD 较W-HUD而言具有更大的投影面积，与投影距离，投影距离目前已经达到5m-7.5m。根据投影距离的不同，AR-HUD的投影成像面积可以达到55时，能够很好地与道路景物进行融合，也能够获得更加丰富的投影信息，可以实现人机交互，让驾驶员能够同时获取到路面交通状况与车内信息，解决视觉盲区的问题。AR-HUD与W-HUD都是安装在仪表台之下，也解决了C-HUD在事故发生时会掉落的风险。</p><p><img src="https://gcore.jsdelivr.net/gh/xiaoguo1417/PicHost@main/img/AR-HUD.png" alt="AR-HUD"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;抬头显示系统（Head-Up Display,HUD)，亦称平视显示系统，是一种光学虚像显示系统。此系统通过光学镜片的反射或折射，将与汽车、飞机行驶相关的各种信息通过位于驾驶者视线正前方的放大虚像来呈现。虚像与景物同时出现在驾驶者的视野中，这样可以让驾驶者的视线一直保持在路</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>C++输入输出记录</title>
    <link href="http://example.com/2022/08/18/C++%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E8%AE%B0%E5%BD%95/"/>
    <id>http://example.com/2022/08/18/C++%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E8%AE%B0%E5%BD%95/</id>
    <published>2022-08-18T03:10:30.783Z</published>
    <updated>2023-04-27T07:59:37.593Z</updated>
    
    <content type="html"><![CDATA[<p>C++中定义了输入输出流将程序与文件进行了连接，下面对常用的程序读取与输出txt和csv文件流程进行记录。</p><img src="https://gcore.jsdelivr.net/gh/xiaoguo1417/PicHost@main/img/image-20220817195038936.png" alt="image-20220817195038936" style="zoom:80%;" /><h2 id="1-写入文件">1. 写入文件</h2><p>写入文件主要使用<mark>ofstream</mark>类对文件操作，操作步骤为包含文件输入输出的头文件；创建流并打开文件；使用重载的<mark>&lt;&lt;</mark>运算符进行文件写入；写入完毕，关闭文件。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fstream&gt;</span><span class="comment">//文件读写的类</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> test[<span class="number">100</span>];</span><br><span class="line"></span><br><span class="line">ofstream out;</span><br><span class="line">out.<span class="built_in">open</span>(<span class="string">&quot;test.csv&quot;</span>);<span class="comment">//文件打开</span></span><br><span class="line"><span class="comment">//或者直接使用 ofstream out(&quot;test.txt&quot;);</span></span><br><span class="line">    <span class="keyword">if</span> (out.<span class="built_in">fail</span>()) &#123;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;打开文件错误!&quot;</span>&lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//写文件，csv以逗号分隔两个数据（txt可自定义分隔），endl换行</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; <span class="number">100</span>;i++) &#123;</span><br><span class="line">out &lt;&lt; test[i] &lt;&lt; <span class="string">&quot;,&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">out &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">out.<span class="built_in">close</span>();<span class="comment">//关闭文件</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-读取文件">2. 读取文件</h2><p>读取文件使用<mark>ifstream</mark>类进行操作，流程与写入时相同，读取时除了可以使用重载的<mark>&gt;&gt;</mark>运算符（逐词读取），还可以使用<mark>getline()</mark>函数（逐行读取）。</p><p>使用cin 和 &gt;&gt; 运算符来输入字符串时，当 cin 读取数据时，它会传递并忽略任何前导白色空格字符（<strong>空格、制表符或换行符</strong>），一旦它接触到第一个非空格字符即开始阅读，当它读取到下一个空白字符时，它将停止读取；</p><p>这里使用的getline()函数定义在头文件string，其四种重载形式如下，其将一个输入流is读取字符串放到str中，默认的停止符delim为’\n’，也就是回车换行符（即遇到换行停止读入），也可以自定义修改这个停止符，如改为’,'等。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">istream&amp; <span class="title">getline</span> <span class="params">(istream&amp; is, string&amp; str, <span class="type">char</span> delim)</span></span>;</span><br><span class="line"><span class="function">istream&amp; <span class="title">getline</span> <span class="params">(istream&amp;&amp; is, string&amp; str, <span class="type">char</span> delim)</span></span>;</span><br><span class="line"><span class="function">istream&amp; <span class="title">getline</span> <span class="params">(istream&amp; is, string&amp; str)</span></span>;</span><br><span class="line"><span class="function">istream&amp; <span class="title">getline</span> <span class="params">(istream&amp;&amp; is, string&amp; str)</span></span>;</span><br></pre></td></tr></table></figure><p>在getline()读取很长的字符串后可以使用<mark>isstringstream</mark>进行分割字符串。isstringstream包含于stringstream标准类库（头文件<mark>sstream</mark>），该类库可以向string写入数据，从string读取数据，就像string是一个IO流一样，istringstream完成从string读取数据。使用时先将string类型的字符串放入isstringstream流中，然后使用重载的<mark>&gt;&gt;</mark>逐词读取。</p><h3 id="2-1-读取空格分隔的txt文件">2.1 读取空格分隔的txt文件</h3><p>下面记录将空格为分隔的txt文件读取得到一个二维数组：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sstream&gt;</span><span class="comment">//支持C++风格的串流的输入输出操作</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="function">ifstream <span class="title">in</span><span class="params">(<span class="string">&quot;test.txt&quot;</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">string rowData;<span class="comment">//一行内容</span></span><br><span class="line">istringstream iss;</span><br><span class="line">string dataVal;</span><br><span class="line">vector&lt;vector&lt;<span class="type">double</span>&gt;&gt;dataVec;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (<span class="built_in">getline</span>(in, rowData))</span><br><span class="line">&#123;</span><br><span class="line">        iss.<span class="built_in">clear</span>();</span><br><span class="line">iss.<span class="built_in">str</span>(rowData);<span class="comment">//将一行的内容放入流中</span></span><br><span class="line">vector&lt;<span class="type">double</span>&gt;rowDataVec;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (iss &gt;&gt; dataVal)</span><br><span class="line">&#123;</span><br><span class="line">rowDataVec.<span class="built_in">push_back</span>(<span class="built_in">atof</span>(dataVal.<span class="built_in">c_str</span>()));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dataVec.<span class="built_in">push_back</span>(rowDataVec);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">in.<span class="built_in">close</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-2-读取csv文件">2.2 读取csv文件</h3><p>读取csv文件到二维数组</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sstream&gt;</span><span class="comment">//支持C++风格的串流的输入输出操作</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="function">ifstream <span class="title">infile</span><span class="params">(<span class="string">&quot;test.csv&quot;</span>)</span></span>;</span><br><span class="line">string line;</span><br><span class="line">vector&lt;vector&lt;<span class="type">double</span>&gt;&gt;dataVec;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (<span class="built_in">getline</span>(infile, line))</span><br><span class="line">&#123;</span><br><span class="line"><span class="function">istringstream <span class="title">sin</span><span class="params">(line)</span></span>;</span><br><span class="line">vector&lt;<span class="type">double</span>&gt; rowDataVec;</span><br><span class="line">string dataVal;</span><br><span class="line"><span class="keyword">while</span> (<span class="built_in">getline</span>(sin, dataVal, <span class="string">&#x27;,&#x27;</span>))</span><br><span class="line">&#123;</span><br><span class="line">rowDataVec.<span class="built_in">push_back</span>(<span class="built_in">atof</span>(dataVal.<span class="built_in">c_str</span>()));</span><br><span class="line">&#125;</span><br><span class="line">dataVec.<span class="built_in">push_back</span>(rowDataVec);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;C++中定义了输入输出流将程序与文件进行了连接，下面对常用的程序读取与输出txt和csv文件流程进行记录。&lt;/p&gt;
&lt;img src=&quot;https://gcore.jsdelivr.net/gh/xiaoguo1417/PicHost@main/img/image-2022</summary>
      
    
    
    
    
    <category term="C++" scheme="http://example.com/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>LIBSVM的VS2015使用记录</title>
    <link href="http://example.com/2022/08/12/LIBSVM%E7%9A%84VS2015%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/"/>
    <id>http://example.com/2022/08/12/LIBSVM%E7%9A%84VS2015%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/</id>
    <published>2022-08-12T11:03:26.768Z</published>
    <updated>2023-04-27T08:01:08.104Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://www.csie.ntu.edu.tw/~cjlin/libsvm/">LIBSVM</a>工具箱是台湾大学林智仁（C.JLin）等人开发的一套简单的、易于使用的SVM模式识别与回归机软件包，该软件包利用收敛性证明的成果改进算法，取得了很好的结果。下面对<strong>LIBSVM(Version 3.25)<strong>在</strong>VS2015</strong>中的==分类==使用进行记录。</p><h2 id="1-使用流程">1. 使用流程</h2><p>(1). LIBSVM所要求的格式准备数据集(也可以自行准备数据格式，需自己写获取数据的函数，记录中以LIBSVM官方数据的格式读取为例)；</p><p>(2). 对数据进行简单的<strong>缩放</strong>操作；</p><p>(3). 考虑选用RBF(radial basis function)核参数；</p><p>(4). 如果选用RBF，通过采用<strong>交叉验证</strong>获取最佳参数C与gamma；</p><p>(5). 采用最佳参数C与g对整个训练集进行训练<strong>获取支持向量机模型</strong>；</p><p>(6). 利用获取的模型进行<strong>测试与预测</strong>。</p><h2 id="2-数据格式介绍">2. 数据格式介绍</h2><p>将LIBSVM官网的文件包进行下载，我们在VS中主要用到==svm.h==和==svm.cpp==两个文件，将其放入自己的工程下，在使用时我将有关函数封装为类<strong>ClassificationSVM</strong>。</p><p>在LIBSVM中，与读取特征文件相关的类型为<strong>svm_problem</strong>，其主要在训练和预测过程中记录导入的数据。这个类中有三个元素，如下所示：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">svm_problem</span> </span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> n; <span class="comment">//记录样本总数</span></span><br><span class="line"><span class="type">double</span> *y; <span class="comment">//记录样本所属类别</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">svm_node</span> **x; <span class="comment">//存储所有样本的特征，二维数组，一行存一个样本的所有特征</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>其中<strong>svm_node</strong>类型的定义如下：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">svm_node</span> <span class="comment">//用来存储输入空间中的单个特征</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> index; <span class="comment">//该特征在特征空间中的维度编号</span></span><br><span class="line"><span class="type">double</span> value; <span class="comment">//该特征的值</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="https://gcore.jsdelivr.net/gh/xiaoguo1417/PicHost@main/img/1.jpg" alt=""></p><p>这次记录过程中我使用的是官方的<a href="https://www.csie.ntu.edu.tw/~cjlin/libsvmtools/datasets/multiclass.html#vowel">vowel</a>数据集，数据集中包含11个分类，每个分类包含48个数据，一共528个数据进行模型训练。官方的数据格式为：</p><p>分类号 1：数据1 2：数据2 3：数据3…</p><p>从txt文件读取到数组中的函数如下：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//从官方文件中读取数据</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ClassificationSVM::readTxt2</span><span class="params">(<span class="type">const</span> std::string&amp; featureFileName)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">dataVec.<span class="built_in">clear</span>();<span class="comment">//dataVec为二维数组，对应svm_problem的x中的数据</span></span><br><span class="line">labels.<span class="built_in">clear</span>();<span class="comment">//labels记录每个数据对应的分类，整型数组</span></span><br><span class="line">featureDim = <span class="number">-1</span>;<span class="comment">//特征数量记录</span></span><br><span class="line">sampleNum = <span class="number">0</span>;<span class="comment">//样本数</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//官方标准样式</span></span><br><span class="line">std::ifstream fin;</span><br><span class="line">std::string rowData;<span class="comment">//一行内容</span></span><br><span class="line">std::istringstream iss;</span><br><span class="line">fin.<span class="built_in">open</span>(featureFileName);</span><br><span class="line"></span><br><span class="line"><span class="comment">//保存特征数据</span></span><br><span class="line">std::string dataVal;</span><br><span class="line"><span class="keyword">while</span> (std::<span class="built_in">getline</span>(fin, rowData))</span><br><span class="line">&#123;</span><br><span class="line">iss.<span class="built_in">clear</span>();</span><br><span class="line">iss.<span class="built_in">str</span>(rowData);</span><br><span class="line"><span class="type">bool</span> first = <span class="literal">true</span>;</span><br><span class="line">std::vector&lt;<span class="type">double</span>&gt;rowDataVec;</span><br><span class="line"><span class="comment">// 逐词读取，遍历每一行中的每个词</span></span><br><span class="line"><span class="keyword">while</span> (iss &gt;&gt; dataVal)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//第一个数据是label分类标识</span></span><br><span class="line"><span class="keyword">if</span> (first) &#123;</span><br><span class="line">first = <span class="literal">false</span>;</span><br><span class="line">labels.<span class="built_in">push_back</span>(<span class="built_in">atof</span>(dataVal.<span class="built_in">c_str</span>()));</span><br><span class="line">sampleNum++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//分割字符串得到冒号后数据</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>;k &lt; dataVal.<span class="built_in">size</span>();k++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (dataVal[k] == <span class="string">&#x27;:&#x27;</span>) &#123;</span><br><span class="line">dataVal = dataVal.<span class="built_in">substr</span>(k+<span class="number">1</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">rowDataVec.<span class="built_in">push_back</span>(<span class="built_in">atof</span>(dataVal.<span class="built_in">c_str</span>()));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">dataVec.<span class="built_in">push_back</span>(rowDataVec);</span><br><span class="line">&#125;</span><br><span class="line">featureDim = dataVec[<span class="number">0</span>].<span class="built_in">size</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-数据缩放">3. 数据缩放</h2><p>缩放的主要优点是避免了较大数值范围内的属性，而支配了较小数值范围内的属性。另一个优点是在计算过程中避免了数值上的困难。缩放输入数据，原始数据范围可能过大或过小，该过程可将数据重新缩放到适当范围使训练与预测速度更快，一般缩放到[0, 1]或[-1, 1]，这里我缩放到[-1, 1]，缩放公式如下：</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>y</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo>=</mo><mtext> lower </mtext><mo>+</mo><mo stretchy="false">(</mo><mtext> upper </mtext><mo>−</mo><mtext> lower </mtext><mo stretchy="false">)</mo><mo>∗</mo><mfrac><mrow><mi>y</mi><mo>−</mo><mi>min</mi><mo>⁡</mo></mrow><mrow><mi>max</mi><mo>⁡</mo><mo>−</mo><mi>min</mi><mo>⁡</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">y^{\prime}=\text { lower }+(\text { upper }-\text { lower }) * \frac{y-\min }{\max -\min }</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9463em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord text"><span class="mord"> lower </span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord text"><span class="mord"> upper </span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord"> lower </span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.3169em;vertical-align:-0.4033em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9136em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mtight">m</span><span class="mtight">a</span><span class="mtight">x</span></span><span class="mspace mtight" style="margin-right:0.1952em;"></span><span class="mord mtight">−</span><span class="mspace mtight" style="margin-right:0.1952em;"></span><span class="mop mtight"><span class="mtight">m</span><span class="mtight">i</span><span class="mtight">n</span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4461em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="mbin mtight">−</span><span class="mop mtight"><span class="mtight">m</span><span class="mtight">i</span><span class="mtight">n</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4033em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//归一化到[-1, 1]，分为训练时缩放，要写一个缩放的文件；预测时读取这个缩放文件</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ClassificationSVM::svmScale</span><span class="params">(<span class="type">bool</span> train_model)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">double</span> *minVals = <span class="keyword">new</span> <span class="type">double</span>[featureDim];</span><br><span class="line"><span class="type">double</span> *maxVals = <span class="keyword">new</span> <span class="type">double</span>[featureDim];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (train_model) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; featureDim;i++)</span><br><span class="line">&#123;</span><br><span class="line">minVals[i] = dataVec[<span class="number">0</span>][i];</span><br><span class="line">maxVals[i] = dataVec[<span class="number">0</span>][i];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; dataVec.<span class="built_in">size</span>();i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>;j &lt; dataVec[i].<span class="built_in">size</span>();j++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (dataVec[i][j] &lt; minVals[j])</span><br><span class="line">minVals[j] = dataVec[i][j];</span><br><span class="line"><span class="keyword">if</span> (dataVec[i][j] &gt; maxVals[j])</span><br><span class="line">maxVals[j] = dataVec[i][j];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//缩放文件存放每个特征的最大最小值</span></span><br><span class="line"><span class="function">std::ofstream <span class="title">out</span><span class="params">(<span class="string">&quot;scale_params.txt&quot;</span>)</span></span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; featureDim;i++)</span><br><span class="line">&#123;</span><br><span class="line">out &lt;&lt; minVals[i] &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">out &lt;&lt; std::endl;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; featureDim;i++)</span><br><span class="line">&#123;</span><br><span class="line">out &lt;&lt; maxVals[i] &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">std::ifstream fin;</span><br><span class="line">std::string rowData;<span class="comment">//一行内容</span></span><br><span class="line">std::istringstream iss;</span><br><span class="line">fin.<span class="built_in">open</span>(<span class="string">&quot;scale_params.txt&quot;</span>);</span><br><span class="line">std::<span class="built_in">getline</span>(fin, rowData);</span><br><span class="line">iss.<span class="built_in">clear</span>();</span><br><span class="line">iss.<span class="built_in">str</span>(rowData);</span><br><span class="line"><span class="type">double</span> dataVal;</span><br><span class="line"><span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line"><span class="comment">// 逐词读取，遍历每一行中的每个词</span></span><br><span class="line"><span class="keyword">while</span> (iss &gt;&gt; dataVal)</span><br><span class="line">&#123;</span><br><span class="line">minVals[count] = dataVal;</span><br><span class="line">count++;</span><br><span class="line">&#125;</span><br><span class="line">count = <span class="number">0</span>;</span><br><span class="line">std::<span class="built_in">getline</span>(fin, rowData);</span><br><span class="line">iss.<span class="built_in">clear</span>();</span><br><span class="line">iss.<span class="built_in">str</span>(rowData);</span><br><span class="line"><span class="keyword">while</span> (iss &gt;&gt; dataVal)</span><br><span class="line">&#123;</span><br><span class="line">maxVals[count] = dataVal;</span><br><span class="line">count++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; dataVec.<span class="built_in">size</span>();i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>;j &lt; dataVec[i].<span class="built_in">size</span>();j++)</span><br><span class="line">&#123;</span><br><span class="line">dataVec[i][j] = <span class="number">-1</span> + <span class="number">2</span> * (dataVec[i][j] - minVals[j]) / (maxVals[j] - minVals[j]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">delete</span> minVals;</span><br><span class="line"><span class="keyword">delete</span> maxVals;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>缩放之后我们就可以将导入的参数dataVec和labels构造到官方的结构svm_problem中。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置prob,prob的定义为：svm_problem prob;</span></span><br><span class="line">prob.l = sampleNum;   <span class="comment">//训练样本数</span></span><br><span class="line">prob.x = <span class="keyword">new</span> svm_node*[sampleNum];  <span class="comment">//特征矩阵</span></span><br><span class="line">prob.y = <span class="keyword">new</span> <span class="type">double</span>[sampleNum];     <span class="comment">//标签矩阵</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; sampleNum; ++i)</span><br><span class="line">&#123;</span><br><span class="line">prob.x[i] = <span class="keyword">new</span> svm_node[featureDim + <span class="number">1</span>]; <span class="comment">//</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; featureDim; ++j)</span><br><span class="line">&#123;</span><br><span class="line">prob.x[i][j].index = j + <span class="number">1</span>;</span><br><span class="line">prob.x[i][j].value = dataVec[i][j];</span><br><span class="line">&#125;</span><br><span class="line">prob.x[i][featureDim].index = <span class="number">-1</span>;</span><br><span class="line">prob.y[i] = labels[i];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-交叉验证">4. 交叉验证</h2><p><a href="https://www.cnblogs.com/pursuit1996/p/5617978.html">交叉验证</a>(Cross Validation)是用来验证分类器的性能一种统计分析方法，基本思想是把在某种意义下将原始数据(dataset)进行分组，一部分做为训练集(train set)，另一部分做为验证集(validation set)，首先用训练集对分类器进行训练,在利用验证集来测试训练得到的模型(model)，以此来做为评价分类器的性能指标。</p><p>这里主要使用K折交叉验证（一般选择5折）去得到最合理的模型中的C和gamma（模型的参数列表如下），官方的tools文件夹下grid.py就是在求解最优化的参数，定义的参数范围时-5 &lt;= log~2~C &lt;= 15，-15 &lt;= log~2~G &lt;= 3，步长均为2，在C++中我们需要调用svm.cpp中的<strong>svm_cross_validation</strong>函数遍历参数来进行交叉验证。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">svm_parameter</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> svm_type;</span><br><span class="line"><span class="type">int</span> kernel_type;</span><br><span class="line"><span class="type">int</span> degree;<span class="comment">/* for poly */</span></span><br><span class="line"><span class="type">double</span> gamma;<span class="comment">/* for poly/rbf/sigmoid */</span></span><br><span class="line"><span class="type">double</span> coef0;<span class="comment">/* for poly/sigmoid */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* these are for training only */</span></span><br><span class="line"><span class="type">double</span> cache_size; <span class="comment">/* in MB */</span></span><br><span class="line"><span class="type">double</span> eps;<span class="comment">/* stopping criteria */</span></span><br><span class="line"><span class="type">double</span> C;<span class="comment">/* for C_SVC, EPSILON_SVR and NU_SVR */</span></span><br><span class="line"><span class="type">int</span> nr_weight;<span class="comment">/* for C_SVC */</span></span><br><span class="line"><span class="type">int</span> *weight_label;<span class="comment">/* for C_SVC */</span></span><br><span class="line"><span class="type">double</span>* weight;<span class="comment">/* for C_SVC */</span></span><br><span class="line"><span class="type">double</span> nu;<span class="comment">/* for NU_SVC, ONE_CLASS, and NU_SVR */</span></span><br><span class="line"><span class="type">double</span> p;<span class="comment">/* for EPSILON_SVR */</span></span><br><span class="line"><span class="type">int</span> shrinking;<span class="comment">/* use the shrinking heuristics */</span></span><br><span class="line"><span class="type">int</span> probability; <span class="comment">/* do probability estimates */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//交叉验证最优化参数求解</span></span><br><span class="line"><span class="type">double</span>* target = <span class="keyword">new</span> <span class="type">double</span>[prob.l];</span><br><span class="line"><span class="type">int</span> logG, logC;</span><br><span class="line"><span class="type">int</span> bestG, bestC;<span class="comment">//记录最好的参数值</span></span><br><span class="line"><span class="type">int</span> minCount = prob.l;<span class="comment">//记录错误的数量</span></span><br><span class="line">std::vector&lt;<span class="type">double</span>&gt;rates;<span class="comment">//记录每次组合对应的正确率</span></span><br><span class="line"><span class="keyword">for</span> (logC = <span class="number">-5</span>;logC &lt;= <span class="number">15</span>;logC += <span class="number">2</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (logG = <span class="number">-15</span>;logG &lt;= <span class="number">3</span>;logG += <span class="number">2</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">double</span> c = <span class="built_in">pow</span>(<span class="number">2</span>, logC);</span><br><span class="line"><span class="type">double</span> g = <span class="built_in">pow</span>(<span class="number">2</span>, logG);</span><br><span class="line"><span class="built_in">setParam</span>(c, g);<span class="comment">//对模型参数进行修改</span></span><br><span class="line"><span class="built_in">svm_cross_validation</span>(&amp;prob, &amp;param, <span class="number">5</span>, target);</span><br><span class="line"><span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; prob.l;i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (target[i] != i % <span class="number">11</span>)</span><br><span class="line">count++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (count &lt; minCount) &#123;</span><br><span class="line">minCount = count;</span><br><span class="line">bestC = c;</span><br><span class="line">bestG = g;</span><br><span class="line">&#125;</span><br><span class="line">rates.<span class="built_in">push_back</span>(<span class="number">1.0</span>*(prob.l-count) / prob.l*<span class="number">100</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//输出每对参数及对应概率</span></span><br><span class="line"><span class="function">std::ofstream <span class="title">out</span><span class="params">(<span class="string">&quot;rates.txt&quot;</span>)</span></span>;</span><br><span class="line"><span class="type">int</span> count1 = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (logC = <span class="number">-5</span>;logC &lt;= <span class="number">15</span>;logC += <span class="number">2</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (logG = <span class="number">-15</span>;logG &lt;= <span class="number">3</span>;logG += <span class="number">2</span>)</span><br><span class="line">&#123;</span><br><span class="line">std::string s1 = <span class="string">&quot;log2c=&quot;</span>;</span><br><span class="line">s1 += std::<span class="built_in">to_string</span>(logC);</span><br><span class="line">std::string s2 = <span class="string">&quot;log2g=&quot;</span>;</span><br><span class="line">s2 += std::<span class="built_in">to_string</span>(logG);</span><br><span class="line">std::string s3 = <span class="string">&quot;rate=&quot;</span>;</span><br><span class="line">s3 += std::<span class="built_in">to_string</span>(rates[count1]);</span><br><span class="line">count1++;</span><br><span class="line"></span><br><span class="line">out &lt;&lt; s1 &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; s2 &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; s3 &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-模型训练">5. 模型训练</h2><p>模型训练主要调用官方的<strong>svm_train</strong>函数。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">std::cout &lt;&lt; <span class="string">&quot;start training&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">svm_model *svmModel = <span class="built_in">svm_train</span>(&amp;prob, &amp;param);</span><br><span class="line"></span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;save model&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"><span class="built_in">svm_save_model</span>(modelFileName.<span class="built_in">c_str</span>(), svmModel);</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;done!&quot;</span> &lt;&lt; std::endl;</span><br></pre></td></tr></table></figure><p>训练完成后将在指定的位置modelFileName生成对应的模型文件。</p><h2 id="6-模型测试（预测）">6. 模型测试（预测）</h2><p>模型的测试使用<strong>svm_predict</strong>函数（或svm_predict_probability函数），流程与上面类似，将文件导入并缩放后，无需交叉验证直接使用导入的模型进行预测得到预测的结果，返回值类型为double是因为该函数包含分类和回归两个方面，我们在回归时返回的其实就是我们输入的labels中的一个分类的分类号（int型数据）。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">ClassificationSVM::predict</span><span class="params">(<span class="type">const</span> std::string&amp; featureFileName, <span class="type">const</span> std::string&amp; modelFileName)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//读取特征文件中的特征及保存模型</span></span><br><span class="line">svm_model *model = <span class="built_in">svm_load_model</span>(modelFileName.<span class="built_in">c_str</span>());</span><br><span class="line"><span class="built_in">readTxt2</span>(featureFileName);</span><br><span class="line"><span class="built_in">svmScale</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//从vector中构造prob</span></span><br><span class="line"><span class="type">int</span> count = <span class="number">0</span>;<span class="comment">//正确预测计数</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; dataVec.<span class="built_in">size</span>();i++)</span><br><span class="line">&#123;</span><br><span class="line">svm_node *sample = <span class="keyword">new</span> svm_node[featureDim + <span class="number">1</span>];</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; featureDim; ++j)</span><br><span class="line">&#123;</span><br><span class="line">sample[j].index = j + <span class="number">1</span>;</span><br><span class="line">sample[j].value = dataVec[i][j];</span><br><span class="line">&#125;</span><br><span class="line">sample[featureDim].index = <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//double *probresut = new double[11];</span></span><br><span class="line"><span class="comment">//double resultLabel = svm_predict_probability(model, sample, probresut);</span></span><br><span class="line"><span class="type">double</span> resultLabel2 = <span class="built_in">svm_predict</span>(model, sample);</span><br><span class="line"><span class="keyword">if</span> (resultLabel - labels[i] &lt; <span class="number">1e-5</span>)</span><br><span class="line">count++;</span><br><span class="line"><span class="comment">//std::cout &lt;&lt; resultLabel2 &lt;&lt; std::endl;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="type">double</span> possibility = <span class="number">1.0</span>*  count / dataVec.<span class="built_in">size</span>();<span class="comment">//正确率</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="7-参考及链接">7. 参考及链接</h2><p><a href="https://blog.csdn.net/zilongreco/article/details/41390385">一个入门的DEMO</a></p><p><a href="https://blog.csdn.net/lhanchao/article/details/53367532">主要参考</a>，但这个里面没有交叉验证</p><p>我的<a href="https://github.com/xiaoguo1417/libsvm">完整程序</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;a href=&quot;https://www.csie.ntu.edu.tw/~cjlin/libsvm/&quot;&gt;LIBSVM&lt;/a&gt;工具箱是台湾大学林智仁（C.JLin）等人开发的一套简单的、易于使用的SVM模式识别与回归机软件包，该软件包利用收敛性证明的成果改进算法，取得了很好</summary>
      
    
    
    
    
    <category term="LIBSVM" scheme="http://example.com/tags/LIBSVM/"/>
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="http://example.com/2022/08/03/hello-world/"/>
    <id>http://example.com/2022/08/03/hello-world/</id>
    <published>2022-08-03T12:28:11.625Z</published>
    <updated>2023-04-27T07:59:47.687Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start">Quick Start</h2><h3 id="Create-a-new-post">Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server">Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files">Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites">Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.io/docs/&quot;&gt;documentation&lt;/a&gt; for</summary>
      
    
    
    
    
  </entry>
  
</feed>
